<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Phalcon Framework. A full-stack PHP framework delivered as a PHP extension, offering lower resource consumption and high performance."><meta name=author content="Phalcon Team"><link href=https://docs.phalcon.io/3.4/db-models/ rel=canonical><link href=../db-odm/ rel=prev><link href=../db-models-behaviors/ rel=next><link rel=icon href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.49"><title>Models - Phalcon Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.6f8fc17f.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Titillium+Web:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Titillium Web";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=../assets/css/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-JR4REKBKH3"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-JR4REKBKH3",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-JR4REKBKH3",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><!-- Fanart --><!--

Phalcon Framework

A full-stack PHP framework delivered as a PHP extension,
offering lower resource consumption and high performance.

<3 Phalcon Team

                         ..
                         ....
   %                  ,   ......
     %%%               ,,  .......
      %%%%%%           ,,,,.........
       %%%%%%%%&        ,,,,,.........,
    /    %%%%%%%%%%      ,,,,,,..........
      //  %%%%%%%%%%%%%    ,,,,,,..........
       //// %%%%%%%%%%%%%%%  ,,,,,,..........,
         ////%%%%%%%%%%%%%%%%%%,,,,,,...........
          ///////%%%%%%%%%%%%%%%%%%,,,,...........
            ////////%%%%%%%%%%%%%%%%%%/,,...........
          %%%%/////////(%%%%%%%%%%%%%%%%%%,..........
            %%%%%//////////%%%%%%%%%%%%%%%%%%........(
               %%%%///////////(%%%%%%%%%%%%%%%%.......(
                 %%%%%////////////%%%%%%%%%%%%%%%.....//
                ....%%%%%////////////#%%%%%%%%%%%%%....//
                   .......(%/////////////%%%%%%%%%%%%..  /
                      ...........///////********/%%%%%..
                     ,,,,.............,/***************.
                         ,,,,,.............************......,/(
                               ,,,,,,..........********.....//////////
                              ((((((((**((((((((((((((*.....///////////
                                  %*********.../(((((((..........///(/#/
                               **********..........#%%%           ..*%%%
                            *********(..........%%%                  %%%
                         *********/..........%%%                     %%
                   %    *******%%.........%%%%
                  %   ******%%%%...../.*((((((   %%%%
                     ****%%%%%%.....///* (((((((%%%%%
                    ***&%%%%%%.....////* ((((((((%%  %
                    *  &%%%%%#..../////*  (((     %
                       &%%%%%....//////*           %
                        %%%% ....//////***   %%%
                     (  %%%   ...*/////*****%%%%
                     (   %     ...  //(*****/%%
                      (  &      ..   // ***  %%
                                 .     /      %
--><!-- Fanart --></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#working-with-models class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Phalcon Documentation" class="md-header__button md-logo" aria-label="Phalcon Documentation" data-md-component=logo> <img src=https://assets.phalcon.io/phalcon/images/svg/phalcon-logo-35x39.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Phalcon Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Models </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=teal aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=teal aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/phalcon/documentation title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> phalcon/documentation </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../introduction/ class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../application/ class=md-tabs__link> Core </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../db-layer/ class=md-tabs__link> Database </a> </li> <li class=md-tabs__item> <a href=../assets/ class=md-tabs__link> Front End </a> </li> <li class=md-tabs__item> <a href=../acl/ class=md-tabs__link> Business Logic </a> </li> <li class=md-tabs__item> <a href=../cache/ class=md-tabs__link> Services </a> </li> <li class=md-tabs__item> <a href=https://github.com/orgs/phalcon/discussions class=md-tabs__link> Discussions </a> </li> <li class=md-tabs__item> <a href=https://github.com/phalcon/phalcon/discussions class=md-tabs__link> Discussions(v6) </a> </li> <li class=md-tabs__item> <a href=https://blog.phalcon.io/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Phalcon Documentation" class="md-nav__button md-logo" aria-label="Phalcon Documentation" data-md-component=logo> <img src=https://assets.phalcon.io/phalcon/images/svg/phalcon-logo-35x39.svg alt=logo> </a> Phalcon Documentation </label> <div class=md-nav__source> <a href=https://github.com/phalcon/documentation title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> phalcon/documentation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2 id=__nav_1_2_label tabindex=0> <span class=md-ellipsis> Changelog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Changelog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://github.com/phalcon/cphalcon/blob/5.0.x/CHANGELOG-5.0.md class=md-nav__link> <span class=md-ellipsis> Current Version </span> </a> </li> <li class=md-nav__item> <a href=../releases.md class=md-nav__link> <span class=md-ellipsis> Releases </span> </a> </li> <li class=md-nav__item> <a href=../upgrade.md class=md-nav__link> <span class=md-ellipsis> How to upgrade </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex=0> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../contributions/ class=md-nav__link> <span class=md-ellipsis> Contributions </span> </a> </li> <li class=md-nav__item> <a href=https://phalcon.io/discussions class=md-nav__link> <span class=md-ellipsis> Asking a question </span> </a> </li> <li class=md-nav__item> <a href=../new-feature-request/ class=md-nav__link> <span class=md-ellipsis> Requesting a change </span> </a> </li> <li class=md-nav__item> <a href=../new-pull-request/ class=md-nav__link> <span class=md-ellipsis> Issuing a Pull Request </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4> <label class=md-nav__link for=__nav_1_4 id=__nav_1_4_label tabindex=0> <span class=md-ellipsis> Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../generating-backtrace/ class=md-nav__link> <span class=md-ellipsis> Backtrace Generation </span> </a> </li> <li class=md-nav__item> <a href=../reproducible-tests/ class=md-nav__link> <span class=md-ellipsis> Reproducible Tests </span> </a> </li> <li class=md-nav__item> <a href=../testing-environment.md class=md-nav__link> <span class=md-ellipsis> Testing environment </span> </a> </li> <li class=md-nav__item> <a href=../coding-standard.md class=md-nav__link> <span class=md-ellipsis> Coding Standard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../sponsors/ class=md-nav__link> <span class=md-ellipsis> Sponsoring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../webserver-setup/ class=md-nav__link> <span class=md-ellipsis> Webserver Setup </span> </a> </li> <li class=md-nav__item> <a href=../webserver-wamp/ class=md-nav__link> <span class=md-ellipsis> WAMP </span> </a> </li> <li class=md-nav__item> <a href=../webserver-xampp/ class=md-nav__link> <span class=md-ellipsis> XAMPP </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> Environments </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Environments </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../environments-nanobox/ class=md-nav__link> <span class=md-ellipsis> Nanobox </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> Development Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Development Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devtools-installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../devtools-usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../debug/ class=md-nav__link> <span class=md-ellipsis> Debug </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tutorial-basic/ class=md-nav__link> <span class=md-ellipsis> Basic </span> </a> </li> <li class=md-nav__item> <a href=../tutorial-invo/ class=md-nav__link> <span class=md-ellipsis> Invo </span> </a> </li> <li class=md-nav__item> <a href=../tutorial-rest/ class=md-nav__link> <span class=md-ellipsis> REST </span> </a> </li> <li class=md-nav__item> <a href=../tutorial-vokuro/ class=md-nav__link> <span class=md-ellipsis> Vokuro </span> </a> </li> <li class=md-nav__item> <a href=../performance/ class=md-nav__link> <span class=md-ellipsis> Performance </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Core </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../application/ class=md-nav__link> <span class=md-ellipsis> Application </span> </a> </li> <li class=md-nav__item> <a href=../application-micro/ class=md-nav__link> <span class=md-ellipsis> Micro </span> </a> </li> <li class=md-nav__item> <a href=../application-cli/ class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> </li> <li class=md-nav__item> <a href=../di/ class=md-nav__link> <span class=md-ellipsis> DI Container </span> </a> </li> <li class=md-nav__item> <a href=../mvc/ class=md-nav__link> <span class=md-ellipsis> MVC </span> </a> </li> <li class=md-nav__item> <a href=../namespaces/ class=md-nav__link> <span class=md-ellipsis> Namespaces </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Database </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../db-layer/ class=md-nav__link> <span class=md-ellipsis> Layer </span> </a> </li> <li class=md-nav__item> <a href=../db-phql/ class=md-nav__link> <span class=md-ellipsis> PHQL </span> </a> </li> <li class=md-nav__item> <a href=../db-odm/ class=md-nav__link> <span class=md-ellipsis> ODM </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Models </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Models </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#creating-models class=md-nav__link> <span class=md-ellipsis> Creating Models </span> </a> <nav class=md-nav aria-label="Creating Models"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#public-properties-vs-settersgetters class=md-nav__link> <span class=md-ellipsis> Public properties vs. Setters/Getters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#understanding-records-to-objects class=md-nav__link> <span class=md-ellipsis> Understanding Records To Objects </span> </a> </li> <li class=md-nav__item> <a href=#finding-records class=md-nav__link> <span class=md-ellipsis> Finding Records </span> </a> <nav class=md-nav aria-label="Finding Records"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#model-resultsets class=md-nav__link> <span class=md-ellipsis> Model Resultsets </span> </a> </li> <li class=md-nav__item> <a href=#custom-resultsets class=md-nav__link> <span class=md-ellipsis> Custom Resultsets </span> </a> </li> <li class=md-nav__item> <a href=#filtering-resultsets class=md-nav__link> <span class=md-ellipsis> Filtering Resultsets </span> </a> </li> <li class=md-nav__item> <a href=#binding-parameters class=md-nav__link> <span class=md-ellipsis> Binding Parameters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#initializingpreparing-fetched-records class=md-nav__link> <span class=md-ellipsis> Initializing/Preparing fetched records </span> </a> </li> <li class=md-nav__item> <a href=#generating-calculations class=md-nav__link> <span class=md-ellipsis> Generating Calculations </span> </a> </li> <li class=md-nav__item> <a href=#creatingupdating-records class=md-nav__link> <span class=md-ellipsis> Creating/Updating Records </span> </a> <nav class=md-nav aria-label="Creating/Updating Records"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#createupdate-with-confidence class=md-nav__link> <span class=md-ellipsis> Create/Update with Confidence </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deleting-records class=md-nav__link> <span class=md-ellipsis> Deleting Records </span> </a> </li> <li class=md-nav__item> <a href=#hydration-modes class=md-nav__link> <span class=md-ellipsis> Hydration Modes </span> </a> </li> <li class=md-nav__item> <a href=#table-prefixes class=md-nav__link> <span class=md-ellipsis> Table prefixes </span> </a> </li> <li class=md-nav__item> <a href=#auto-generated-identity-columns class=md-nav__link> <span class=md-ellipsis> Auto-generated identity columns </span> </a> </li> <li class=md-nav__item> <a href=#skipping-columns class=md-nav__link> <span class=md-ellipsis> Skipping Columns </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-updates class=md-nav__link> <span class=md-ellipsis> Dynamic Updates </span> </a> </li> <li class=md-nav__item> <a href=#independent-column-mapping class=md-nav__link> <span class=md-ellipsis> Independent Column Mapping </span> </a> </li> <li class=md-nav__item> <a href=#record-snapshots class=md-nav__link> <span class=md-ellipsis> Record Snapshots </span> </a> </li> <li class=md-nav__item> <a href=#pointing-to-a-different-schema class=md-nav__link> <span class=md-ellipsis> Pointing to a different schema </span> </a> </li> <li class=md-nav__item> <a href=#setting-multiple-databases class=md-nav__link> <span class=md-ellipsis> Setting multiple databases </span> </a> </li> <li class=md-nav__item> <a href=#injecting-services-into-models class=md-nav__link> <span class=md-ellipsis> Injecting services into Models </span> </a> </li> <li class=md-nav__item> <a href=#disablingenabling-features class=md-nav__link> <span class=md-ellipsis> Disabling/Enabling Features </span> </a> </li> <li class=md-nav__item> <a href=#stand-alone-component class=md-nav__link> <span class=md-ellipsis> Stand-Alone component </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../db-models-behaviors/ class=md-nav__link> <span class=md-ellipsis> Behaviors </span> </a> </li> <li class=md-nav__item> <a href=../db-models-cache/ class=md-nav__link> <span class=md-ellipsis> Cache </span> </a> </li> <li class=md-nav__item> <a href=../db-models-events/ class=md-nav__link> <span class=md-ellipsis> Events </span> </a> </li> <li class=md-nav__item> <a href=../db-models-metadata/ class=md-nav__link> <span class=md-ellipsis> Metadata </span> </a> </li> <li class=md-nav__item> <a href=../db-models-relationships/ class=md-nav__link> <span class=md-ellipsis> Relationships </span> </a> </li> <li class=md-nav__item> <a href=../db-models-transactions/ class=md-nav__link> <span class=md-ellipsis> Transactions </span> </a> </li> <li class=md-nav__item> <a href=../db-models-validation/ class=md-nav__link> <span class=md-ellipsis> Validators </span> </a> </li> <li class=md-nav__item> <a href=../db-pagination/ class=md-nav__link> <span class=md-ellipsis> Pagination </span> </a> </li> <li class=md-nav__item> <a href=../db-migrations/ class=md-nav__link> <span class=md-ellipsis> Migrations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Front End </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Front End </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../assets/ class=md-nav__link> <span class=md-ellipsis> Assets </span> </a> </li> <li class=md-nav__item> <a href=../flash/ class=md-nav__link> <span class=md-ellipsis> Flash Messenger </span> </a> </li> <li class=md-nav__item> <a href=../forms/ class=md-nav__link> <span class=md-ellipsis> Forms </span> </a> </li> <li class=md-nav__item> <a href=../image/ class=md-nav__link> <span class=md-ellipsis> Image </span> </a> </li> <li class=md-nav__item> <a href=../tag/ class=md-nav__link> <span class=md-ellipsis> Tag </span> </a> </li> <li class=md-nav__item> <a href=../views/ class=md-nav__link> <span class=md-ellipsis> View </span> </a> </li> <li class=md-nav__item> <a href=../volt/ class=md-nav__link> <span class=md-ellipsis> Volt </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Business Logic </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Business Logic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../acl/ class=md-nav__link> <span class=md-ellipsis> Access Control Lists </span> </a> </li> <li class=md-nav__item> <a href=../annotations/ class=md-nav__link> <span class=md-ellipsis> Annotations </span> </a> </li> <li class=md-nav__item> <a href=../controllers/ class=md-nav__link> <span class=md-ellipsis> Controllers </span> </a> </li> <li class=md-nav__item> <a href=../dispatcher/ class=md-nav__link> <span class=md-ellipsis> Dispatcher </span> </a> </li> <li class=md-nav__item> <a href=../events/ class=md-nav__link> <span class=md-ellipsis> Event Manager </span> </a> </li> <li class=md-nav__item> <a href=../filter/ class=md-nav__link> <span class=md-ellipsis> Filters </span> </a> </li> <li class=md-nav__item> <a href=../routing/ class=md-nav__link> <span class=md-ellipsis> Routing </span> </a> </li> <li class=md-nav__item> <a href=../session/ class=md-nav__link> <span class=md-ellipsis> Sessions </span> </a> </li> <li class=md-nav__item> <a href=../url/ class=md-nav__link> <span class=md-ellipsis> Url </span> </a> </li> <li class=md-nav__item> <a href=../validation/ class=md-nav__link> <span class=md-ellipsis> Validation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Services </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cache/ class=md-nav__link> <span class=md-ellipsis> Cache </span> </a> </li> <li class=md-nav__item> <a href=../config/ class=md-nav__link> <span class=md-ellipsis> Config </span> </a> </li> <li class=md-nav__item> <a href=../escaper/ class=md-nav__link> <span class=md-ellipsis> Escaper </span> </a> </li> <li class=md-nav__item> <a href=../loader/ class=md-nav__link> <span class=md-ellipsis> Loader </span> </a> </li> <li class=md-nav__item> <a href=../logging/ class=md-nav__link> <span class=md-ellipsis> Logger </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_6> <label class=md-nav__link for=__nav_7_6 id=__nav_7_6_label tabindex=0> <span class=md-ellipsis> HTTP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_6_label aria-expanded=false> <label class=md-nav__title for=__nav_7_6> <span class="md-nav__icon md-icon"></span> HTTP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cookies/ class=md-nav__link> <span class=md-ellipsis> Cookies </span> </a> </li> <li class=md-nav__item> <a href=../request/ class=md-nav__link> <span class=md-ellipsis> Request </span> </a> </li> <li class=md-nav__item> <a href=../response/ class=md-nav__link> <span class=md-ellipsis> Response </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_7> <label class=md-nav__link for=__nav_7_7 id=__nav_7_7_label tabindex=0> <span class=md-ellipsis> i18n </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7_7> <span class="md-nav__icon md-icon"></span> i18n </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../i18n/ class=md-nav__link> <span class=md-ellipsis> Internationalization </span> </a> </li> <li class=md-nav__item> <a href=../translate/ class=md-nav__link> <span class=md-ellipsis> Translate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../queue/ class=md-nav__link> <span class=md-ellipsis> Queue </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_9> <label class=md-nav__link for=__nav_7_9 id=__nav_7_9_label tabindex=0> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_9_label aria-expanded=false> <label class=md-nav__title for=__nav_7_9> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../crypt/ class=md-nav__link> <span class=md-ellipsis> Cryptography </span> </a> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://github.com/orgs/phalcon/discussions class=md-nav__link> <span class=md-ellipsis> Discussions </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/phalcon/phalcon/discussions class=md-nav__link> <span class=md-ellipsis> Discussions(v6) </span> </a> </li> <li class=md-nav__item> <a href=https://blog.phalcon.io/ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#creating-models class=md-nav__link> <span class=md-ellipsis> Creating Models </span> </a> <nav class=md-nav aria-label="Creating Models"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#public-properties-vs-settersgetters class=md-nav__link> <span class=md-ellipsis> Public properties vs. Setters/Getters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#understanding-records-to-objects class=md-nav__link> <span class=md-ellipsis> Understanding Records To Objects </span> </a> </li> <li class=md-nav__item> <a href=#finding-records class=md-nav__link> <span class=md-ellipsis> Finding Records </span> </a> <nav class=md-nav aria-label="Finding Records"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#model-resultsets class=md-nav__link> <span class=md-ellipsis> Model Resultsets </span> </a> </li> <li class=md-nav__item> <a href=#custom-resultsets class=md-nav__link> <span class=md-ellipsis> Custom Resultsets </span> </a> </li> <li class=md-nav__item> <a href=#filtering-resultsets class=md-nav__link> <span class=md-ellipsis> Filtering Resultsets </span> </a> </li> <li class=md-nav__item> <a href=#binding-parameters class=md-nav__link> <span class=md-ellipsis> Binding Parameters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#initializingpreparing-fetched-records class=md-nav__link> <span class=md-ellipsis> Initializing/Preparing fetched records </span> </a> </li> <li class=md-nav__item> <a href=#generating-calculations class=md-nav__link> <span class=md-ellipsis> Generating Calculations </span> </a> </li> <li class=md-nav__item> <a href=#creatingupdating-records class=md-nav__link> <span class=md-ellipsis> Creating/Updating Records </span> </a> <nav class=md-nav aria-label="Creating/Updating Records"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#createupdate-with-confidence class=md-nav__link> <span class=md-ellipsis> Create/Update with Confidence </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deleting-records class=md-nav__link> <span class=md-ellipsis> Deleting Records </span> </a> </li> <li class=md-nav__item> <a href=#hydration-modes class=md-nav__link> <span class=md-ellipsis> Hydration Modes </span> </a> </li> <li class=md-nav__item> <a href=#table-prefixes class=md-nav__link> <span class=md-ellipsis> Table prefixes </span> </a> </li> <li class=md-nav__item> <a href=#auto-generated-identity-columns class=md-nav__link> <span class=md-ellipsis> Auto-generated identity columns </span> </a> </li> <li class=md-nav__item> <a href=#skipping-columns class=md-nav__link> <span class=md-ellipsis> Skipping Columns </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-updates class=md-nav__link> <span class=md-ellipsis> Dynamic Updates </span> </a> </li> <li class=md-nav__item> <a href=#independent-column-mapping class=md-nav__link> <span class=md-ellipsis> Independent Column Mapping </span> </a> </li> <li class=md-nav__item> <a href=#record-snapshots class=md-nav__link> <span class=md-ellipsis> Record Snapshots </span> </a> </li> <li class=md-nav__item> <a href=#pointing-to-a-different-schema class=md-nav__link> <span class=md-ellipsis> Pointing to a different schema </span> </a> </li> <li class=md-nav__item> <a href=#setting-multiple-databases class=md-nav__link> <span class=md-ellipsis> Setting multiple databases </span> </a> </li> <li class=md-nav__item> <a href=#injecting-services-into-models class=md-nav__link> <span class=md-ellipsis> Injecting services into Models </span> </a> </li> <li class=md-nav__item> <a href=#disablingenabling-features class=md-nav__link> <span class=md-ellipsis> Disabling/Enabling Features </span> </a> </li> <li class=md-nav__item> <a href=#stand-alone-component class=md-nav__link> <span class=md-ellipsis> Stand-Alone component </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/phalcon/documentation/edit/master/docs/db-models.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/phalcon/documentation/raw/master/docs/db-models.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=working-with-models>Working with Models<a class=headerlink href=#working-with-models title="Permanent link">&para;</a></h1> <p>A model represents the information (data) of the application and the rules to manipulate that data. Models are primarily used for managing the rules of interaction with a corresponding database table. In most cases, each table in your database will correspond to one model in your application. The bulk of your application's business logic will be concentrated in the models.</p> <p><a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> is the base for all models in a Phalcon application. It provides database independence, basic CRUD functionality, advanced finding capabilities, and the ability to relate models to one another, among other services. <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> avoids the need of having to use SQL statements because it translates methods dynamically to the respective database engine operations.</p> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>Models are intended to work with the database on a high layer of abstraction. If you need to work with databases at a lower level check out the <a href=../api/Phalcon_Db/ >Phalcon\Db</a> component documentation.</p> </div> <h2 id=creating-models>Creating Models<a class=headerlink href=#creating-models title="Permanent link">&para;</a></h2> <p>A model is a class that extends from <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a>. Its class name should be in camel case notation:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=k>class</span> <span class=nc>RobotParts</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=p>{</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=p>}</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>If you're using PHP 5.4/5.5 it is recommended you declare each column that makes part of the model in order to save memory and reduce the memory allocation. </p> </div> <p>By default, the model <code>Store\Toys\RobotParts</code> will map to the table <code>robot_parts</code>. If you want to manually specify another name for the mapped table, you can use the <code>setSource()</code> method:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=k>class</span> <span class=nc>RobotParts</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=p>{</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>    <span class=p>{</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>setSource</span><span class=p>(</span><span class=s1>&#39;toys_robot_parts&#39;</span><span class=p>);</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>    <span class=p>}</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=p>}</span>
</code></pre></div> <p>The model <code>RobotParts</code> now maps to <code>toys_robot_parts</code> table. The <code>initialize()</code> method helps with setting up this model with a custom behavior i.e. a different table.</p> <p>The <code>initialize()</code> method is only called once during the request. This method is intended to perform initializations that apply for all instances of the model created within the application. If you want to perform initialization tasks for every instance created you can use the <code>onConstruct()</code> method:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=k>class</span> <span class=nc>RobotParts</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=p>{</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>onConstruct</span><span class=p>()</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>    <span class=p>{</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>        <span class=c1>// ...</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=p>}</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=p>}</span>
</code></pre></div> <h3 id=public-properties-vs-settersgetters>Public properties vs. Setters/Getters<a class=headerlink href=#public-properties-vs-settersgetters title="Permanent link">&para;</a></h3> <p>Models can be implemented public properties, meaning that each property can be read/updated from any part of the code that has instantiated that model class:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=p>{</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=k>public</span> <span class=nv>$id</span><span class=p>;</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=k>public</span> <span class=nv>$price</span><span class=p>;</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=p>}</span>
</code></pre></div> <p>Another implementation is to use getters and setter functions, which control which properties are publicly available for that model. The benefit of using getters and setters is that the developer can perform transformations and validation checks on the values set for the model, which is impossible when using public properties. Additionally getters and setters allow for future changes without changing the interface of the model class. So if a field name changes, the only change needed will be in the private property of the model referenced in the relevant getter/setter and nowhere else in the code.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=k>use</span> <span class=nx>InvalidArgumentException</span><span class=p>;</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=p>{</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>    <span class=k>protected</span> <span class=nv>$id</span><span class=p>;</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>    <span class=k>protected</span> <span class=nv>$name</span><span class=p>;</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>    <span class=k>protected</span> <span class=nv>$price</span><span class=p>;</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=p>{</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>    <span class=p>}</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setName</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=p>{</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>        <span class=c1>// The name is too short?</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>        <span class=k>if</span> <span class=p>(</span><span class=nb>strlen</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>            <span class=k>throw</span> <span class=k>new</span> <span class=nx>InvalidArgumentException</span><span class=p>(</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>                <span class=s1>&#39;The name is too short&#39;</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>            <span class=p>);</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>        <span class=p>}</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=nv>$name</span><span class=p>;</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=p>}</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getName</span><span class=p>()</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>    <span class=p>{</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>    <span class=p>}</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setPrice</span><span class=p>(</span><span class=nv>$price</span><span class=p>)</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>    <span class=p>{</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>        <span class=c1>// Negative prices aren&#39;t allowed</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>        <span class=k>if</span> <span class=p>(</span><span class=nv>$price</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>            <span class=k>throw</span> <span class=k>new</span> <span class=nx>InvalidArgumentException</span><span class=p>(</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>                <span class=s2>&quot;Price can&#39;t be negative&quot;</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>            <span class=p>);</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>        <span class=p>}</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>price</span> <span class=o>=</span> <span class=nv>$price</span><span class=p>;</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>    <span class=p>}</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getPrice</span><span class=p>()</span>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>    <span class=p>{</span>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a>        <span class=c1>// Convert the value to double before be used</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a>        <span class=k>return</span> <span class=p>(</span><span class=nx>double</span><span class=p>)</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>price</span><span class=p>;</span>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a>    <span class=p>}</span>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a><span class=p>}</span>
</code></pre></div> <p>Public properties provide less complexity in development. However getters/setters can heavily increase the testability, extensibility and maintainability of applications. Developers can decide which strategy is more appropriate for the application they are creating, depending on the needs of the application. The ORM is compatible with both schemes of defining properties.</p> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>Underscores in property names can be problematic when using getters and setters. </p> </div> <p>If you use underscores in your property names, you must still use camel case in your getter/setter declarations for use with magic methods. (e.g. <code>$model-&gt;getPropertyName</code> instead of <code>$model-&gt;getProperty_name</code>, <code>$model-&gt;findByPropertyName</code> instead of <code>$model-&gt;findByProperty_name</code>, etc.). As much of the system expects camel case, and underscores are commonly removed, it is recommended to name your properties in the manner shown throughout the documentation. You can use a column map (as described above) to ensure proper mapping of your properties to their database counterparts.</p> <h2 id=understanding-records-to-objects>Understanding Records To Objects<a class=headerlink href=#understanding-records-to-objects title="Permanent link">&para;</a></h2> <p>Every instance of a model represents a row in the table. You can easily access record data by reading object properties. For example, for a table 'robots' with the records:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>robots</span><span class=p>;</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=o>+</span><span class=c1>----+------------+------------+------+</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=k>type</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=k>year</span><span class=w> </span><span class=o>|</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=o>+</span><span class=c1>----+------------+------------+------+</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Robotina</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>mechanical</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1972</span><span class=w> </span><span class=o>|</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Astro</span><span class=w> </span><span class=n>Boy</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>mechanical</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1952</span><span class=w> </span><span class=o>|</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Terminator</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>cyborg</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>2029</span><span class=w> </span><span class=o>|</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=o>+</span><span class=c1>----+------------+------------+------+</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=mi>3</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span>
</code></pre></div> <p>You could find a certain record by its primary key and then print its name:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=c1>// Find record with id = 3</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=c1>// Prints &#39;Terminator&#39;</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</code></pre></div> <p>Once the record is in memory, you can make modifications to its data and then save changes:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=s1>&#39;RoboCop&#39;</span><span class=p>;</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
</code></pre></div> <p>As you can see, there is no need to use raw SQL statements. <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> provides high database abstraction for web applications.</p> <h2 id=finding-records>Finding Records<a class=headerlink href=#finding-records title="Permanent link">&para;</a></h2> <p><a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> also offers several methods for querying records. The following examples will show you how to query one or more records from a model:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=c1>// How many robots are there?</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>();</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>echo</span> <span class=s1>&#39;There are &#39;</span><span class=p>,</span> <span class=nb>count</span><span class=p>(</span><span class=nv>$robots</span><span class=p>),</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=c1>// How many mechanical robots are there?</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=s2>&quot;type = &#39;mechanical&#39;&quot;</span><span class=p>);</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>echo</span> <span class=s1>&#39;There are &#39;</span><span class=p>,</span> <span class=nb>count</span><span class=p>(</span><span class=nv>$robots</span><span class=p>),</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=c1>// Get and print virtual robots ordered by name</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>    <span class=p>[</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>        <span class=s2>&quot;type = &#39;virtual&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>        <span class=s1>&#39;order&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>    <span class=p>]</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=p>);</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=p>}</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=c1>// Get first 100 virtual robots ordered by name</span>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>    <span class=p>[</span>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a>        <span class=s2>&quot;type = &#39;virtual&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>        <span class=s1>&#39;order&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>        <span class=s1>&#39;limit&#39;</span> <span class=o>=&gt;</span> <span class=mi>100</span><span class=p>,</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a>    <span class=p>]</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=p>);</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>   <span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=p>}</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>If you want find record by external data (such as user input) or variable data you must use <a href=#binding-parameters>Binding Parameters</a>`.</p> </div> <p>You could also use the <code>findFirst()</code> method to get only the first record matching the given criteria:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=c1>// What&#39;s the first robot in robots table?</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>();</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=k>echo</span> <span class=s1>&#39;The robot name is &#39;</span><span class=p>,</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=c1>// What&#39;s the first mechanical robot in robots table?</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span><span class=s2>&quot;type = &#39;mechanical&#39;&quot;</span><span class=p>);</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=k>echo</span> <span class=s1>&#39;The first mechanical robot name is &#39;</span><span class=p>,</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=c1>// Get first virtual robot ordered by name</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>    <span class=p>[</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>        <span class=s2>&quot;type = &#39;virtual&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>        <span class=s1>&#39;order&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>    <span class=p>]</span>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=p>);</span>
<a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>
<a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=k>echo</span> <span class=s1>&#39;The first virtual robot name is &#39;</span><span class=p>,</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
</code></pre></div> <p>Both <code>find()</code> and <code>findFirst()</code> methods accept an associative array specifying the search criteria:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>    <span class=p>[</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>        <span class=s2>&quot;type = &#39;virtual&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>        <span class=s1>&#39;order&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;name DESC&#39;</span><span class=p>,</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>        <span class=s1>&#39;limit&#39;</span> <span class=o>=&gt;</span> <span class=mi>30</span><span class=p>,</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=p>]</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=p>);</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>    <span class=p>[</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;type = ?1&#39;</span><span class=p>,</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>        <span class=s1>&#39;bind&#39;</span>       <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>            <span class=mi>1</span> <span class=o>=&gt;</span> <span class=s1>&#39;virtual&#39;</span><span class=p>,</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>        <span class=p>]</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>    <span class=p>]</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=p>);</span>
</code></pre></div> <p>The available query options are:</p> <table> <thead> <tr> <th>Parameter</th> <th>Description</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code>conditions</code></td> <td>Search conditions for the find operation. Is used to extract only those records that fulfill a specified criterion. By default <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> assumes the first parameter are the conditions.</td> <td><code>'conditions' =&gt; "name LIKE 'steve%'"</code></td> </tr> <tr> <td><code>columns</code></td> <td>Return specific columns instead of the full columns in the model. When using this option an incomplete object is returned</td> <td><code>'columns' =&gt; 'id, name'</code></td> </tr> <tr> <td><code>bind</code></td> <td>Bind is used together with options, by replacing placeholders and escaping values thus increasing security</td> <td><code>'bind' =&gt; ['status' =&gt; 'A', 'type' =&gt; 'some-time']</code></td> </tr> <tr> <td><code>bindTypes</code></td> <td>When binding parameters, you can use this parameter to define additional casting to the bound parameters increasing even more the security</td> <td><code>'bindTypes' =&gt; [Column::BIND_PARAM_STR, Column::BIND_PARAM_INT]</code></td> </tr> <tr> <td><code>order</code></td> <td>Is used to sort the resultset. Use one or more fields separated by commas.</td> <td><code>'order' =&gt; 'name DESC, status'</code></td> </tr> <tr> <td><code>limit</code></td> <td>Limit the results of the query to results to certain range</td> <td><code>'limit' =&gt; 10</code></td> </tr> <tr> <td><code>offset</code></td> <td>Offset the results of the query by a certain amount</td> <td><code>'offset' =&gt; 5</code></td> </tr> <tr> <td><code>group</code></td> <td>Allows to collect data across multiple records and group the results by one or more columns</td> <td><code>'group' =&gt; 'name, status'</code></td> </tr> <tr> <td><code>for_update</code></td> <td>With this option, <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> reads the latest available data, setting exclusive locks on each row it reads</td> <td><code>'for_update' =&gt; true</code></td> </tr> <tr> <td><code>shared_lock</code></td> <td>With this option, <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> reads the latest available data, setting shared locks on each row it reads</td> <td><code>'shared_lock' =&gt; true</code></td> </tr> <tr> <td><code>cache</code></td> <td>Cache the resultset, reducing the continuous access to the relational system</td> <td><code>'cache' =&gt; ['lifetime' =&gt; 3600, 'key' =&gt; 'my-find-key']</code></td> </tr> <tr> <td><code>hydration</code></td> <td>Sets the hydration strategy to represent each returned record in the result</td> <td><code>'hydration' =&gt; Resultset::HYDRATE_OBJECTS</code></td> </tr> </tbody> </table> <p>If you prefer, there is also available a way to create queries in an object-oriented way, instead of using an array of parameters:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>query</span><span class=p>()</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>    <span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;type = :type:&#39;</span><span class=p>)</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>    <span class=o>-&gt;</span><span class=na>andWhere</span><span class=p>(</span><span class=s1>&#39;year &lt; 2000&#39;</span><span class=p>)</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=o>-&gt;</span><span class=na>bind</span><span class=p>([</span><span class=s1>&#39;type&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;mechanical&#39;</span><span class=p>])</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>    <span class=o>-&gt;</span><span class=na>order</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>    <span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
</code></pre></div> <p>The static method <code>query()</code> returns a <a href=../api/Phalcon_Mvc_Model_Criteria/ >Phalcon\Mvc\Model\Criteria</a> object that is friendly with IDE autocompleters.</p> <p>All the queries are internally handled as <a href=../db-phql/ >PHQL</a> queries. PHQL is a high-level, object-oriented and SQL-like language. This language provide you more features to perform queries like joining other models, define groupings, add aggregations etc.</p> <p>Lastly, there is the <code>findFirstBy&lt;property-name&gt;()</code> method. This method expands on the <code>findFirst()</code> method mentioned earlier. It allows you to quickly perform a retrieval from a table by using the property name in the method itself and passing it a parameter that contains the data you want to search for in that column. An example is in order, so taking our Robots model mentioned earlier:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>{</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>    <span class=k>public</span> <span class=nv>$id</span><span class=p>;</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=k>public</span> <span class=nv>$price</span><span class=p>;</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=p>}</span>
</code></pre></div> <p>We have three properties to work with here: <code>$id</code>, <code>$name</code> and <code>$price</code>. So, let's say you want to retrieve the first record in the table with the name 'Terminator'. This could be written like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=nv>$name</span> <span class=o>=</span> <span class=s1>&#39;Terminator&#39;</span><span class=p>;</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirstByName</span><span class=p>(</span><span class=nv>$name</span><span class=p>);</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=k>if</span> <span class=p>(</span><span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>    <span class=k>echo</span> <span class=s1>&#39;The first robot with the name &#39;</span> <span class=o>.</span> <span class=nv>$name</span> <span class=o>.</span> <span class=s1>&#39; cost &#39;</span> <span class=o>.</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>price</span> <span class=o>.</span> <span class=s1>&#39;.&#39;</span><span class=p>;</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>    <span class=k>echo</span> <span class=s1>&#39;There were no robots found in our table with the name &#39;</span> <span class=o>.</span> <span class=nv>$name</span> <span class=o>.</span> <span class=s1>&#39;.&#39;</span><span class=p>;</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=p>}</span>
</code></pre></div> <p>Notice that we used 'Name' in the method call and passed the variable <code>$name</code> to it, which contains the name we are looking for in our table. Notice also that when we find a match with our query, all the other properties are available to us as well.</p> <h3 id=model-resultsets>Model Resultsets<a class=headerlink href=#model-resultsets title="Permanent link">&para;</a></h3> <p>While <code>findFirst()</code> returns directly an instance of the called class (when there is data to be returned), the <code>find()</code> method returns a <a href=../api/Phalcon_Mvc_Model_Resultset/ >Phalcon\Mvc\Model\Resultset\Simple</a>. This is an object that encapsulates all the functionality a resultset has like traversing, seeking specific records, counting, etc.</p> <p>These objects are more powerful than standard arrays. One of the greatest features of the <a href=../api/Phalcon_Mvc_Model_Resultset/ >Phalcon\Mvc\Model\Resultset</a> is that at any time there is only one record in memory. This greatly helps in memory management especially when working with large amounts of data.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=c1>// Get all robots</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>();</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=c1>// Traversing with a foreach</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=p>}</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=c1>// Traversing with a while</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>rewind</span><span class=p>();</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=k>while</span> <span class=p>(</span><span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>valid</span><span class=p>())</span> <span class=p>{</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>    <span class=nv>$robot</span> <span class=o>=</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>current</span><span class=p>();</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>    <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>next</span><span class=p>();</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=p>}</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=c1>// Count the resultset</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=k>echo</span> <span class=nb>count</span><span class=p>(</span><span class=nv>$robots</span><span class=p>);</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=c1>// Alternative way to count the resultset</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=k>echo</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>count</span><span class=p>();</span>
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a>
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=c1>// Move the internal cursor to the third robot</span>
<a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>seek</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
<a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a>
<a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>current</span><span class=p>();</span>
<a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a>
<a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=c1>// Access a robot by its position in the resultset</span>
<a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nv>$robots</span><span class=p>[</span><span class=mi>5</span><span class=p>];</span>
<a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a>
<a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=c1>// Check if there is a record in certain position</span>
<a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=k>if</span> <span class=p>(</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$robots</span><span class=p>[</span><span class=mi>3</span><span class=p>]))</span> <span class=p>{</span>
<a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a>   <span class=nv>$robot</span> <span class=o>=</span> <span class=nv>$robots</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
<a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=p>}</span>
<a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a>
<a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a><span class=c1>// Get the first record in the resultset</span>
<a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>getFirst</span><span class=p>();</span>
<a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a>
<a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a><span class=c1>// Get the last record</span>
<a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>getLast</span><span class=p>();</span>
</code></pre></div> <p>Phalcon's resultsets emulate scrollable cursors, you can get any row just by accessing its position, or seeking the internal pointer to a specific position. Note that some database systems don't support scrollable cursors, this forces to re-execute the query in order to rewind the cursor to the beginning and obtain the record at the requested position. Similarly, if a resultset is traversed several times, the query must be executed the same number of times.</p> <p>As storing large query results in memory could consume many resources, resultsets are obtained from the database in chunks of 32 rows - reducing the need to re-execute the request in several cases.</p> <p>Note that resultsets can be serialized and stored in a cache backend. <a href=../api/Phalcon_Cache/ >Phalcon\Cache</a> can help with that task. However, serializing data causes <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> to retrieve all the data from the database in an array, thus consuming more memory while this process takes place.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=c1>// Query all records from model parts</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=nv>$parts</span> <span class=o>=</span> <span class=nx>Parts</span><span class=o>::</span><span class=na>find</span><span class=p>();</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=c1>// Store the resultset into a file</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=nb>file_put_contents</span><span class=p>(</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>    <span class=s1>&#39;cache.txt&#39;</span><span class=p>,</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>    <span class=nb>serialize</span><span class=p>(</span><span class=nv>$parts</span><span class=p>)</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=p>);</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=c1>// Get parts from file</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=nv>$parts</span> <span class=o>=</span> <span class=nb>unserialize</span><span class=p>(</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>    <span class=nb>file_get_contents</span><span class=p>(</span><span class=s1>&#39;cache.txt&#39;</span><span class=p>)</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=p>);</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=c1>// Traverse the parts</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$parts</span> <span class=k>as</span> <span class=nv>$part</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>    <span class=k>echo</span> <span class=nv>$part</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=p>}</span>
</code></pre></div> <h3 id=custom-resultsets>Custom Resultsets<a class=headerlink href=#custom-resultsets title="Permanent link">&para;</a></h3> <p>There are times that the application logic requires additional manipulation of the data as it is retrieved from the database. Previously, we would just extend the model and encapsulate the functionality in a class in the model or a trait, returning back to the caller usually an array of transformed data. </p> <p>With custom resultsets, you no longer need to do that. The custom resultset will encapsulate the functionality that otherwise would be in the model and can be reused by other models, thus keeping the code <a href=https://en.wikipedia.org/wiki/Don%27t_repeat_yourself>DRY</a>. This way, the <code>find()</code> method will no longer return the default <a href=../api/Phalcon_Mvc_Model_Resultset/ >Phalcon\Mvc\Model\Resultset</a>, but instead the custom one. Phalcon allows you to do this by using the <code>getResultsetClass()</code> in your model.</p> <p>First we need to define the resultset class: <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>namespace</span> <span class=nx>Application\Mvc\Model\Resultset</span><span class=p>;</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=k>use</span> <span class=nx>\Phalcon\Mvc\Model\Resultset\Simple</span><span class=p>;</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=k>class</span> <span class=nc>Custom</span> <span class=k>extends</span> <span class=nx>Simple</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=p>{</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getSomeData</span><span class=p>()</span> <span class=p>{</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>        <span class=sd>/** CODE */</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>    <span class=p>}</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=p>}</span>
</code></pre></div></p> <p>In the model, we set the class in the <code>getResultsetClass()</code> as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=k>namespace</span> <span class=nx>Phalcon\Test\Models\Statistics</span><span class=p>;</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=p>{</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getSource</span><span class=p>()</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>    <span class=p>{</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>        <span class=k>return</span> <span class=s1>&#39;robots&#39;</span><span class=p>;</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>    <span class=p>}</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getResultsetClass</span><span class=p>()</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>    <span class=p>{</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>    <span class=k>return</span> <span class=s1>&#39;Application\Mvc\Model\Resultset\Custom&#39;</span><span class=p>;</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>    <span class=p>}</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=p>}</span>
</code></pre></div> <p>and finally in your code you will have something like this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=sd>/**</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=sd> * Find the robots </span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=sd> */</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>    <span class=p>[</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;date between &quot;2017-01-01&quot; AND &quot;2017-12-31&quot;&#39;</span><span class=p>,</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>        <span class=s1>&#39;order&#39;</span>      <span class=o>=&gt;</span> <span class=s1>&#39;date&#39;</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>    <span class=p>]</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=p>);</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=sd>/**</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=sd> * Pass the data to the view</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=sd> */</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>view</span><span class=o>-&gt;</span><span class=na>mydata</span> <span class=o>=</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>getSomeData</span><span class=p>();</span>
</code></pre></div> <h3 id=filtering-resultsets>Filtering Resultsets<a class=headerlink href=#filtering-resultsets title="Permanent link">&para;</a></h3> <p>The most efficient way to filter data is setting some search criteria, databases will use indexes set on tables to return data faster. Phalcon additionally allows you to filter the data using PHP using any resource that is not available in the database:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=nv>$customers</span> <span class=o>=</span> <span class=nx>Customers</span><span class=o>::</span><span class=na>find</span><span class=p>();</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=nv>$customers</span> <span class=o>=</span> <span class=nv>$customers</span><span class=o>-&gt;</span><span class=na>filter</span><span class=p>(</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    <span class=k>function</span> <span class=p>(</span><span class=nv>$customer</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>        <span class=c1>// Return only customers with a valid e-mail</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>        <span class=k>if</span> <span class=p>(</span><span class=nb>filter_var</span><span class=p>(</span><span class=nv>$customer</span><span class=o>-&gt;</span><span class=na>email</span><span class=p>,</span> <span class=nx>FILTER_VALIDATE_EMAIL</span><span class=p>))</span> <span class=p>{</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>            <span class=k>return</span> <span class=nv>$customer</span><span class=p>;</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>        <span class=p>}</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>    <span class=p>}</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=p>);</span>
</code></pre></div> <h3 id=binding-parameters>Binding Parameters<a class=headerlink href=#binding-parameters title="Permanent link">&para;</a></h3> <p>Bound parameters are also supported in <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a>. You are encouraged to use this methodology so as to eliminate the possibility of your code being subject to SQL injection attacks. Both string and integer placeholders are supported. Binding parameters can simply be achieved as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=c1>// Query robots binding parameters with string placeholders</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=c1>// Parameters whose keys are the same as placeholders</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>    <span class=p>[</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>        <span class=s1>&#39;name = :name: AND type = :type:&#39;</span><span class=p>,</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>        <span class=s1>&#39;bind&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>            <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Robotina&#39;</span><span class=p>,</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>            <span class=s1>&#39;type&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;maid&#39;</span><span class=p>,</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>        <span class=p>],</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>    <span class=p>]</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=p>);</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=c1>// Query robots binding parameters with integer placeholders</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>    <span class=p>[</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a>        <span class=s1>&#39;name = ?1 AND type = ?2&#39;</span><span class=p>,</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>        <span class=s1>&#39;bind&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a>            <span class=mi>1</span> <span class=o>=&gt;</span> <span class=s1>&#39;Robotina&#39;</span><span class=p>,</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a>            <span class=mi>2</span> <span class=o>=&gt;</span> <span class=s1>&#39;maid&#39;</span><span class=p>,</span>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a>        <span class=p>],</span>
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a>    <span class=p>]</span>
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=p>);</span>
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a>
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=c1>// Query robots binding parameters with both string and integer placeholders</span>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=c1>// Parameters whose keys are the same as placeholders</span>
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a>    <span class=p>[</span>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a>        <span class=s1>&#39;name = :name: AND type = ?1&#39;</span><span class=p>,</span>
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a>        <span class=s1>&#39;bind&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a>            <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Robotina&#39;</span><span class=p>,</span>
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a>            <span class=mi>1</span>      <span class=o>=&gt;</span> <span class=s1>&#39;maid&#39;</span><span class=p>,</span>
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a>        <span class=p>],</span>
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a>    <span class=p>]</span>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=p>);</span>
</code></pre></div> <p>When using numeric placeholders, you will need to define them as integers i.e. <code>1</code> or <code>2</code>. In this case <code>'1'</code> or <code>'2'</code> are considered strings and not numbers, so the placeholder could not be successfully replaced.</p> <p>Strings are automatically escaped using <a href=https://php.net/manual/en/pdo.prepared-statements.php>PDO</a>. This function takes into account the connection charset, so its recommended to define the correct charset in the connection parameters or in the database configuration, as a wrong charset will produce undesired effects when storing or retrieving data.</p> <p>Additionally you can set the parameter <code>bindTypes</code>, this allows defining how the parameters should be bound according to its data type:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=k>use</span> <span class=nx>Phalcon\Db\Column</span><span class=p>;</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=c1>// Bind parameters</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=nv>$parameters</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>    <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Robotina&#39;</span><span class=p>,</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>    <span class=s1>&#39;year&#39;</span> <span class=o>=&gt;</span> <span class=mi>2008</span><span class=p>,</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=p>];</span>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=c1>// Casting Types</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=nv>$types</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>    <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=nx>Column</span><span class=o>::</span><span class=na>BIND_PARAM_STR</span><span class=p>,</span>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>    <span class=s1>&#39;year&#39;</span> <span class=o>=&gt;</span> <span class=nx>Column</span><span class=o>::</span><span class=na>BIND_PARAM_INT</span><span class=p>,</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=p>];</span>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=c1>// Query robots binding parameters with string placeholders</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>    <span class=p>[</span>
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>        <span class=s1>&#39;name = :name: AND year = :year:&#39;</span><span class=p>,</span>
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>        <span class=s1>&#39;bind&#39;</span>      <span class=o>=&gt;</span> <span class=nv>$parameters</span><span class=p>,</span>
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>        <span class=s1>&#39;bindTypes&#39;</span> <span class=o>=&gt;</span> <span class=nv>$types</span><span class=p>,</span>
<a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>    <span class=p>]</span>
<a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a><span class=p>);</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>Since the default bind-type is <code>Phalcon\Db\Column::BIND_PARAM_STR</code>, there is no need to specify the 'bindTypes' parameter if all of the columns are of that type.</p> </div> <p>If you bind arrays in bound parameters, keep in mind, that keys must be numbered from zero:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=nv>$array</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=s1>&#39;b&#39;</span><span class=p>,</span><span class=s1>&#39;c&#39;</span><span class=p>];</span> <span class=c1>// $array: [[0] =&gt; &#39;a&#39;, [1] =&gt; &#39;b&#39;, [2] =&gt; &#39;c&#39;]</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=nb>unset</span><span class=p>(</span><span class=nv>$array</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span> <span class=c1>// $array: [[0] =&gt; &#39;a&#39;, [2] =&gt; &#39;c&#39;]</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=c1>// Now we have to renumber the keys</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=nv>$array</span> <span class=o>=</span> <span class=nb>array_values</span><span class=p>(</span><span class=nv>$array</span><span class=p>);</span> <span class=c1>// $array: [[0] =&gt; &#39;a&#39;, [1] =&gt; &#39;c&#39;]</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    <span class=p>[</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>        <span class=s1>&#39;letter IN ({letter:array})&#39;</span><span class=p>,</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>        <span class=s1>&#39;bind&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>            <span class=s1>&#39;letter&#39;</span> <span class=o>=&gt;</span> <span class=nv>$array</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>        <span class=p>]</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a>    <span class=p>]</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=p>);</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>Bound parameters are available for all query methods such as <code>find()</code> and <code>findFirst()</code> but also the calculation methods like <code>count()</code>, <code>sum()</code>, <code>average()</code> etc. </p> </div> <p>If you're using "finders" e.g. <code>find()</code>, <code>findFirst()</code>, etc., bound parameters are automatically used:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=c1>// Explicit query using bound parameters</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>    <span class=p>[</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>        <span class=s1>&#39;name = ?0&#39;</span><span class=p>,</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>        <span class=s1>&#39;bind&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>            <span class=s1>&#39;Ultron&#39;</span><span class=p>,</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>        <span class=p>],</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>    <span class=p>]</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=p>);</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=c1>// Implicit query using bound parameters</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findByName</span><span class=p>(</span><span class=s1>&#39;Ultron&#39;</span><span class=p>);</span>
</code></pre></div> <h2 id=initializingpreparing-fetched-records>Initializing/Preparing fetched records<a class=headerlink href=#initializingpreparing-fetched-records title="Permanent link">&para;</a></h2> <p>May be the case that after obtaining a record from the database is necessary to initialise the data before being used by the rest of the application. You can implement the <code>afterFetch()</code> method in a model, this event will be executed just after create the instance and assign the data to it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=p>{</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>    <span class=k>public</span> <span class=nv>$id</span><span class=p>;</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>    <span class=k>public</span> <span class=nv>$status</span><span class=p>;</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>beforeSave</span><span class=p>()</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>    <span class=p>{</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>        <span class=c1>// Convert the array into a string</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span> <span class=o>=</span> <span class=nb>join</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span><span class=p>);</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>    <span class=p>}</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>afterFetch</span><span class=p>()</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>    <span class=p>{</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>        <span class=c1>// Convert the string to an array</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span> <span class=o>=</span> <span class=nb>explode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span><span class=p>);</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>    <span class=p>}</span>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>afterSave</span><span class=p>()</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>    <span class=p>{</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>        <span class=c1>// Convert the string to an array</span>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span> <span class=o>=</span> <span class=nb>explode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span><span class=p>);</span>
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a>    <span class=p>}</span>
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a><span class=p>}</span>
</code></pre></div> <p>If you use getters/setters instead of/or together with public properties, you can initialize the field once it is accessed:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=p>{</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>    <span class=k>public</span> <span class=nv>$id</span><span class=p>;</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>    <span class=k>public</span> <span class=nv>$status</span><span class=p>;</span>
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getStatus</span><span class=p>()</span>
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>    <span class=p>{</span>
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>        <span class=k>return</span> <span class=nb>explode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span><span class=p>);</span>
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>    <span class=p>}</span>
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=p>}</span>
</code></pre></div> <h2 id=generating-calculations>Generating Calculations<a class=headerlink href=#generating-calculations title="Permanent link">&para;</a></h2> <p>Calculations (or aggregations) are helpers for commonly used functions of database systems such as <code>COUNT</code>, <code>SUM</code>, <code>MAX</code>, <code>MIN</code> or <code>AVG</code>. <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> allows to use these functions directly from the exposed methods.</p> <p>Count examples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=c1>// How many employees are?</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=nv>$rowcount</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>count</span><span class=p>();</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=c1>// How many different areas are assigned to employees?</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=nv>$rowcount</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>count</span><span class=p>(</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>    <span class=p>[</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>        <span class=s1>&#39;distinct&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;area&#39;</span><span class=p>,</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>    <span class=p>]</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=p>);</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=c1>// How many employees are in the Testing area?</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=nv>$rowcount</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>count</span><span class=p>(</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a>    <span class=s1>&#39;area = &#39;</span><span class=nx>Testing</span><span class=s1>&#39;&#39;</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=p>);</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=c1>// Count employees grouping results by their area</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=nv>$group</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>count</span><span class=p>(</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a>    <span class=p>[</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a>        <span class=s1>&#39;group&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;area&#39;</span><span class=p>,</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>    <span class=p>]</span>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=p>);</span>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$group</span> <span class=k>as</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a>   <span class=k>echo</span> <span class=s1>&#39;There are &#39;</span><span class=p>,</span> <span class=nv>$row</span><span class=o>-&gt;</span><span class=na>rowcount</span><span class=p>,</span> <span class=s1>&#39; in &#39;</span><span class=p>,</span> <span class=nv>$row</span><span class=o>-&gt;</span><span class=na>area</span><span class=p>;</span>
<a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=p>}</span>
<a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a>
<a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=c1>// Count employees grouping by their area and ordering the result by count</span>
<a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=nv>$group</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>count</span><span class=p>(</span>
<a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a>    <span class=p>[</span>
<a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a>        <span class=s1>&#39;group&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;area&#39;</span><span class=p>,</span>
<a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a>        <span class=s1>&#39;order&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;rowcount&#39;</span><span class=p>,</span>
<a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a>    <span class=p>]</span>
<a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a><span class=p>);</span>
<a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a>
<a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a><span class=c1>// Avoid SQL injections using bound parameters</span>
<a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a><span class=nv>$group</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>count</span><span class=p>(</span>
<a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a>    <span class=p>[</span>
<a id=__codelineno-26-39 name=__codelineno-26-39 href=#__codelineno-26-39></a>        <span class=s1>&#39;type &gt; ?0&#39;</span><span class=p>,</span>
<a id=__codelineno-26-40 name=__codelineno-26-40 href=#__codelineno-26-40></a>        <span class=s1>&#39;bind&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-26-41 name=__codelineno-26-41 href=#__codelineno-26-41></a>            <span class=nv>$type</span>
<a id=__codelineno-26-42 name=__codelineno-26-42 href=#__codelineno-26-42></a>        <span class=p>],</span>
<a id=__codelineno-26-43 name=__codelineno-26-43 href=#__codelineno-26-43></a>    <span class=p>]</span>
<a id=__codelineno-26-44 name=__codelineno-26-44 href=#__codelineno-26-44></a><span class=p>);</span>
</code></pre></div> <p>Sum examples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=c1>// How much are the salaries of all employees?</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=nv>$total</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>sum</span><span class=p>(</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>    <span class=p>[</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>        <span class=s1>&#39;column&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>    <span class=p>]</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=p>);</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=c1>// How much are the salaries of all employees in the Sales area?</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=nv>$total</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>sum</span><span class=p>(</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>    <span class=p>[</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>        <span class=s1>&#39;column&#39;</span>     <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s2>&quot;area = &#39;Sales&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>    <span class=p>]</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=p>);</span>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=c1>// Generate a grouping of the salaries of each area</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=nv>$group</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>sum</span><span class=p>(</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>    <span class=p>[</span>
<a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a>        <span class=s1>&#39;column&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>        <span class=s1>&#39;group&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;area&#39;</span><span class=p>,</span>
<a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a>    <span class=p>]</span>
<a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=p>);</span>
<a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$group</span> <span class=k>as</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a>   <span class=k>echo</span> <span class=s1>&#39;The sum of salaries of the &#39;</span><span class=p>,</span> <span class=nv>$row</span><span class=o>-&gt;</span><span class=na>area</span><span class=p>,</span> <span class=s1>&#39; is &#39;</span><span class=p>,</span> <span class=nv>$row</span><span class=o>-&gt;</span><span class=na>sumatory</span><span class=p>;</span>
<a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=p>}</span>
<a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a>
<a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a><span class=c1>// Generate a grouping of the salaries of each area ordering</span>
<a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a><span class=c1>// salaries from higher to lower</span>
<a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a><span class=nv>$group</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>sum</span><span class=p>(</span>
<a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a>    <span class=p>[</span>
<a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a>        <span class=s1>&#39;column&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a>        <span class=s1>&#39;group&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;area&#39;</span><span class=p>,</span>
<a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a>        <span class=s1>&#39;order&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;sumatory DESC&#39;</span><span class=p>,</span>
<a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a>    <span class=p>]</span>
<a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a><span class=p>);</span>
<a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a>
<a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a><span class=c1>// Avoid SQL injections using bound parameters</span>
<a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a><span class=nv>$group</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>sum</span><span class=p>(</span>
<a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a>    <span class=p>[</span>
<a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;area &gt; ?0&#39;</span><span class=p>,</span>
<a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a>        <span class=s1>&#39;bind&#39;</span>       <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a>            <span class=nv>$area</span>
<a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a>        <span class=p>],</span>
<a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a>    <span class=p>]</span>
<a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a><span class=p>);</span>
</code></pre></div> <p>Average examples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=c1>// What is the average salary for all employees?</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=nv>$average</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>average</span><span class=p>(</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>    <span class=p>[</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>        <span class=s1>&#39;column&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>    <span class=p>]</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=p>);</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=c1>// What is the average salary for the Sales&#39;s area employees?</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=nv>$average</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>average</span><span class=p>(</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a>    <span class=p>[</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>        <span class=s1>&#39;column&#39;</span>     <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s2>&quot;area = &#39;Sales&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a>    <span class=p>]</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=p>);</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=c1>// Avoid SQL injections using bound parameters</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=nv>$average</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>average</span><span class=p>(</span>
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a>    <span class=p>[</span>
<a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a>        <span class=s1>&#39;column&#39;</span>     <span class=o>=&gt;</span> <span class=s1>&#39;age&#39;</span><span class=p>,</span>
<a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;area &gt; ?0&#39;</span><span class=p>,</span>
<a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a>        <span class=s1>&#39;bind&#39;</span>       <span class=o>=&gt;</span> <span class=p>[</span>
<a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a>            <span class=nv>$area</span>
<a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a>        <span class=p>],</span>
<a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a>    <span class=p>]</span>
<a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=p>);</span>
</code></pre></div> <p>Max/Min examples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=c1>// What is the oldest age of all employees?</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=nv>$age</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>maximum</span><span class=p>(</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>    <span class=p>[</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>        <span class=s1>&#39;column&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;age&#39;</span><span class=p>,</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a>    <span class=p>]</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=p>);</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=c1>// What is the oldest of employees from the Sales area?</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=nv>$age</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>maximum</span><span class=p>(</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a>    <span class=p>[</span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a>        <span class=s1>&#39;column&#39;</span>     <span class=o>=&gt;</span> <span class=s1>&#39;age&#39;</span><span class=p>,</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a>        <span class=s1>&#39;conditions&#39;</span> <span class=o>=&gt;</span> <span class=s2>&quot;area = &#39;Sales&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a>    <span class=p>]</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=p>);</span>
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a>
<a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=c1>// What is the lowest salary of all employees?</span>
<a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=nv>$salary</span> <span class=o>=</span> <span class=nx>Employees</span><span class=o>::</span><span class=na>minimum</span><span class=p>(</span>
<a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a>    <span class=p>[</span>
<a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a>        <span class=s1>&#39;column&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a>    <span class=p>]</span>
<a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=p>);</span>
</code></pre></div> <h2 id=creatingupdating-records>Creating/Updating Records<a class=headerlink href=#creatingupdating-records title="Permanent link">&para;</a></h2> <p>The <code>Phalcon\Mvc\Model::save()</code> method allows you to create/update records according to whether they already exist in the table associated with a model. The save method is called internally by the create and update methods of <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a>. For this to work as expected it is necessary to have properly defined a primary key in the entity to determine whether a record should be updated or created.</p> <p>Also the method executes associated validators, virtual foreign keys and events that are defined in the model:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>type</span> <span class=o>=</span> <span class=s1>&#39;mechanical&#39;</span><span class=p>;</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=s1>&#39;Astro Boy&#39;</span><span class=p>;</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>year</span> <span class=o>=</span> <span class=mi>1952</span><span class=p>;</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=k>if</span> <span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>()</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a>    <span class=k>echo</span> <span class=s2>&quot;Umh, We can&#39;t store robots right now: </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>    <span class=nv>$messages</span> <span class=o>=</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>getMessages</span><span class=p>();</span>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a>
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$messages</span> <span class=k>as</span> <span class=nv>$message</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a>        <span class=k>echo</span> <span class=nv>$message</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a>    <span class=p>}</span>
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a>    <span class=k>echo</span> <span class=s1>&#39;Great, a new robot was saved successfully!&#39;</span><span class=p>;</span>
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=p>}</span>
</code></pre></div> <p>An array could be passed to <code>save</code> to avoid assign every column manually. <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> will check if there are setters implemented for the columns passed in the array giving priority to them instead of assign directly the values of the attributes:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>(</span>
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a>    <span class=p>[</span>
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a>        <span class=s1>&#39;type&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;mechanical&#39;</span><span class=p>,</span>
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a>        <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Astro Boy&#39;</span><span class=p>,</span>
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a>        <span class=s1>&#39;year&#39;</span> <span class=o>=&gt;</span> <span class=mi>1952</span><span class=p>,</span>
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a>    <span class=p>]</span>
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=p>);</span>
</code></pre></div> <p>Values assigned directly or via the array of attributes are escaped/sanitized according to the related attribute data type. So you can pass an insecure array without worrying about possible SQL injections:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>);</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>Without precautions mass assignment could allow attackers to set any database column's value. Only use this feature if you want to permit a user to insert/update every column in the model, even if those fields are not in the submitted form. </p> </div> <p>You can set an additional parameter in <code>save</code> to set a whitelist of fields that only must taken into account when doing the mass assignment:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>(</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a>    <span class=nv>$_POST</span><span class=p>,</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>    <span class=p>[</span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a>        <span class=s1>&#39;name&#39;</span><span class=p>,</span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a>        <span class=s1>&#39;type&#39;</span><span class=p>,</span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a>    <span class=p>]</span>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=p>);</span>
</code></pre></div> <h3 id=createupdate-with-confidence>Create/Update with Confidence<a class=headerlink href=#createupdate-with-confidence title="Permanent link">&para;</a></h3> <p>When an application has a lot of competition, we could be expecting create a record but it is actually updated. This could happen if we use <code>Phalcon\Mvc\Model::save()</code> to persist the records in the database. If we want to be absolutely sure that a record is created or updated, we can change the <code>save()</code> call with <code>create()</code> or <code>update()</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>type</span> <span class=o>=</span> <span class=s1>&#39;mechanical&#39;</span><span class=p>;</span>
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=s1>&#39;Astro Boy&#39;</span><span class=p>;</span>
<a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>year</span> <span class=o>=</span> <span class=mi>1952</span><span class=p>;</span>
<a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a>
<a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=c1>// This record only must be created</span>
<a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=k>if</span> <span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>create</span><span class=p>()</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a>    <span class=k>echo</span> <span class=s2>&quot;Umh, We can&#39;t store robots right now: </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a>
<a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a>    <span class=nv>$messages</span> <span class=o>=</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>getMessages</span><span class=p>();</span>
<a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a>
<a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$messages</span> <span class=k>as</span> <span class=nv>$message</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a>        <span class=k>echo</span> <span class=nv>$message</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a>    <span class=p>}</span>
<a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a>    <span class=k>echo</span> <span class=s1>&#39;Great, a new robot was created successfully!&#39;</span><span class=p>;</span>
<a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a><span class=p>}</span>
</code></pre></div> <p>The methods <code>create</code> and <code>update</code> also accept an array of values as parameter.</p> <h2 id=deleting-records>Deleting Records<a class=headerlink href=#deleting-records title="Permanent link">&para;</a></h2> <p>The <code>Phalcon\Mvc\Model::delete()</code> method allows to delete a record. You can use it as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span><span class=mi>11</span><span class=p>);</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=k>if</span> <span class=p>(</span><span class=nv>$robot</span> <span class=o>!==</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>    <span class=k>if</span> <span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>delete</span><span class=p>()</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a>        <span class=k>echo</span> <span class=s2>&quot;Sorry, we can&#39;t delete the robot right now: </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>        <span class=nv>$messages</span> <span class=o>=</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>getMessages</span><span class=p>();</span>
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$messages</span> <span class=k>as</span> <span class=nv>$message</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a>            <span class=k>echo</span> <span class=nv>$message</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a>        <span class=p>}</span>
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a>        <span class=k>echo</span> <span class=s1>&#39;The robot was deleted successfully!&#39;</span><span class=p>;</span>
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>    <span class=p>}</span>
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=p>}</span>
</code></pre></div> <p>You can also delete many records by traversing a resultset with a <code>foreach</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>    <span class=s2>&quot;type = &#39;mechanical&#39;&quot;</span>
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=p>);</span>
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>    <span class=k>if</span> <span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>delete</span><span class=p>()</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>        <span class=k>echo</span> <span class=s2>&quot;Sorry, we can&#39;t delete the robot right now: </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>        <span class=nv>$messages</span> <span class=o>=</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>getMessages</span><span class=p>();</span>
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$messages</span> <span class=k>as</span> <span class=nv>$message</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>            <span class=k>echo</span> <span class=nv>$message</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a>        <span class=p>}</span>
<a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a>        <span class=k>echo</span> <span class=s1>&#39;The robot was deleted successfully!&#39;</span><span class=p>;</span>
<a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a>    <span class=p>}</span>
<a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a><span class=p>}</span>
</code></pre></div> <p>The following events are available to define custom business rules that can be executed when a delete operation is performed:</p> <table> <thead> <tr> <th>Operation</th> <th>Name</th> <th style="text-align: center;">Can stop operation?</th> <th>Explanation</th> </tr> </thead> <tbody> <tr> <td>Deleting</td> <td>afterDelete</td> <td style="text-align: center;">No</td> <td>Runs after the delete operation was made</td> </tr> <tr> <td>Deleting</td> <td>beforeDelete</td> <td style="text-align: center;">Yes</td> <td>Runs before the delete operation is made</td> </tr> </tbody> </table> <p>With the above events can also define business rules in the models:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=p>{</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>beforeDelete</span><span class=p>()</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>    <span class=p>{</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>status</span> <span class=o>===</span> <span class=s1>&#39;A&#39;</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>            <span class=k>echo</span> <span class=s2>&quot;The robot is active, it can&#39;t be deleted&quot;</span><span class=p>;</span>
<a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a>
<a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
<a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a>        <span class=p>}</span>
<a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a>
<a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a>        <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
<a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a>    <span class=p>}</span>
<a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=p>}</span>
</code></pre></div> <h2 id=hydration-modes>Hydration Modes<a class=headerlink href=#hydration-modes title="Permanent link">&para;</a></h2> <p>As mentioned previously, resultsets are collections of complete objects, this means that every returned result is an object representing a row in the database. These objects can be modified and saved again to persistence:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>();</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=c1>// Manipulating a resultset of complete objects</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>    <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>year</span> <span class=o>=</span> <span class=mi>2000</span><span class=p>;</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>    <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=p>}</span>
</code></pre></div> <p>Sometimes records are obtained only to be presented to a user in read-only mode, in these cases it may be useful to change the way in which records are represented to facilitate their handling. The strategy used to represent objects returned in a resultset is called 'hydration mode':</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model\Resultset</span><span class=p>;</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>();</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=c1>// Return every robot as an array</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>setHydrateMode</span><span class=p>(</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a>    <span class=nx>Resultset</span><span class=o>::</span><span class=na>HYDRATE_ARRAYS</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=p>);</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=p>[</span><span class=s1>&#39;year&#39;</span><span class=p>],</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=p>}</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=c1>// Return every robot as a stdClass</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>setHydrateMode</span><span class=p>(</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a>    <span class=nx>Resultset</span><span class=o>::</span><span class=na>HYDRATE_OBJECTS</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=p>);</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>year</span><span class=p>,</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=p>}</span>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=c1>// Return every robot as a Robots instance</span>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>setHydrateMode</span><span class=p>(</span>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a>    <span class=nx>Resultset</span><span class=o>::</span><span class=na>HYDRATE_RECORDS</span>
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=p>);</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>year</span><span class=p>,</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
<a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=p>}</span>
</code></pre></div> <p>Hydration mode can also be passed as a parameter of <code>find</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model\Resultset</span><span class=p>;</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=nv>$robots</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>    <span class=p>[</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>        <span class=s1>&#39;hydration&#39;</span> <span class=o>=&gt;</span> <span class=nx>Resultset</span><span class=o>::</span><span class=na>HYDRATE_ARRAYS</span><span class=p>,</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>    <span class=p>]</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=p>);</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>    <span class=k>echo</span> <span class=nv>$robot</span><span class=p>[</span><span class=s1>&#39;year&#39;</span><span class=p>],</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=p>}</span>
</code></pre></div> <h2 id=table-prefixes>Table prefixes<a class=headerlink href=#table-prefixes title="Permanent link">&para;</a></h2> <p>If you want all your tables to have certain prefix and without setting source in all models you can use the <code>Phalcon\Mvc\Model\Manager</code> and the method <code>setModelPrefix()</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model\Manager</span><span class=p>;</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=p>{</span>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=p>}</span>
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a>
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=nv>$manager</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Manager</span><span class=p>();</span>
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=nv>$manager</span><span class=o>-&gt;</span><span class=na>setModelPrefix</span><span class=p>(</span><span class=s1>&#39;wp_&#39;</span><span class=p>);</span>
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=nv>$robots</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>(</span><span class=k>null</span><span class=p>,</span> <span class=k>null</span><span class=p>,</span> <span class=nv>$manager</span><span class=p>);</span>
<a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=k>echo</span> <span class=nv>$robots</span><span class=o>-&gt;</span><span class=na>getSource</span><span class=p>();</span> <span class=c1>// will return wp_robots</span>
</code></pre></div> <h2 id=auto-generated-identity-columns>Auto-generated identity columns<a class=headerlink href=#auto-generated-identity-columns title="Permanent link">&para;</a></h2> <p>Some models may have identity columns. These columns usually are the primary key of the mapped table. <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> can recognize the identity column omitting it in the generated SQL <code>INSERT</code>, so the database system can generate an auto-generated value for it. Always after creating a record, the identity field will be registered with the value generated in the database system for it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=k>echo</span> <span class=s1>&#39;The generated id is: &#39;</span><span class=p>,</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
</code></pre></div> <p><a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> is able to recognize the identity column. Depending on the database system, those columns may be serial columns like in PostgreSQL or auto_increment columns in the case of MySQL.</p> <p>PostgreSQL uses sequences to generate auto-numeric values, by default, Phalcon tries to obtain the generated value from the sequence <code>table_field_seq</code>, for example: <code>robots_id_seq</code>, if that sequence has a different name, the <code>getSequenceName()</code> method needs to be implemented:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=p>{</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getSequenceName</span><span class=p>()</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>    <span class=p>{</span>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>        <span class=k>return</span> <span class=s1>&#39;robots_sequence_name&#39;</span><span class=p>;</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a>    <span class=p>}</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=p>}</span>
</code></pre></div> <h2 id=skipping-columns>Skipping Columns<a class=headerlink href=#skipping-columns title="Permanent link">&para;</a></h2> <p>To tell <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> that always omits some fields in the creation and/or update of records in order to delegate the database system the assignation of the values by a trigger or a default:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=p>{</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a>    <span class=p>{</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>        <span class=c1>// Skips fields/columns on both INSERT/UPDATE operations</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>skipAttributes</span><span class=p>(</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a>            <span class=p>[</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a>                <span class=s1>&#39;year&#39;</span><span class=p>,</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a>                <span class=s1>&#39;price&#39;</span><span class=p>,</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a>            <span class=p>]</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>        <span class=p>);</span>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a>        <span class=c1>// Skips only when inserting</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>skipAttributesOnCreate</span><span class=p>(</span>
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a>            <span class=p>[</span>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a>                <span class=s1>&#39;created_at&#39;</span><span class=p>,</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a>            <span class=p>]</span>
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>        <span class=p>);</span>
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a>
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a>        <span class=c1>// Skips only when updating</span>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>skipAttributesOnUpdate</span><span class=p>(</span>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a>            <span class=p>[</span>
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a>                <span class=s1>&#39;modified_in&#39;</span><span class=p>,</span>
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a>            <span class=p>]</span>
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a>        <span class=p>);</span>
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a>    <span class=p>}</span>
<a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a><span class=p>}</span>
</code></pre></div> <p>This will ignore globally these fields on each <code>INSERT</code>/<code>UPDATE</code> operation on the whole application. If you want to ignore different attributes on different <code>INSERT</code>/<code>UPDATE</code> operations, you can specify the second parameter (boolean) - <code>true</code> for replacement. Forcing a default value can be done as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=k>use</span> <span class=nx>Phalcon\Db\RawValue</span><span class=p>;</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span>       <span class=o>=</span> <span class=s1>&#39;Bender&#39;</span><span class=p>;</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>year</span>       <span class=o>=</span> <span class=mi>1999</span><span class=p>;</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>created_at</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>RawValue</span><span class=p>(</span><span class=s1>&#39;default&#39;</span><span class=p>);</span>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>create</span><span class=p>();</span>
</code></pre></div> <p>A callback also can be used to create a conditional assignment of automatic default values:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=k>use</span> <span class=nx>Phalcon\Db\RawValue</span><span class=p>;</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=p>{</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>beforeCreate</span><span class=p>()</span>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a>    <span class=p>{</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>price</span> <span class=o>&gt;</span> <span class=mi>10000</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>type</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>RawValue</span><span class=p>(</span><span class=s1>&#39;default&#39;</span><span class=p>);</span>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>        <span class=p>}</span>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a>    <span class=p>}</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=p>}</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p>Never use a <a href=../api/Phalcon_Db/ >Phalcon\Db\RawValue</a> to assign external data (such as user input) or variable data. The value of these fields is ignored when binding parameters to the query. So it could be used to attack the application injecting SQL. </p> </div> <h2 id=dynamic-updates>Dynamic Updates<a class=headerlink href=#dynamic-updates title="Permanent link">&para;</a></h2> <p>SQL <code>UPDATE</code> statements are by default created with every column defined in the model (full all-field SQL update). You can change specific models to make dynamic updates, in this case, just the fields that had changed are used to create the final SQL statement.</p> <p>In some cases this could improve the performance by reducing the traffic between the application and the database server, this specially helps when the table has blob/text fields:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=p>{</span>
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>    <span class=p>{</span>
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>useDynamicUpdate</span><span class=p>(</span><span class=k>true</span><span class=p>);</span>
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a>    <span class=p>}</span>
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=p>}</span>
</code></pre></div> <h2 id=independent-column-mapping>Independent Column Mapping<a class=headerlink href=#independent-column-mapping title="Permanent link">&para;</a></h2> <p>The ORM supports an independent column map, which allows the developer to use different column names in the model to the ones in the table. Phalcon will recognize the new column names and will rename them accordingly to match the respective columns in the database. This is a great feature when one needs to rename fields in the database without having to worry about all the queries in the code. A change in the column map in the model will take care of the rest. For example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=p>{</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a>    <span class=k>public</span> <span class=nv>$code</span><span class=p>;</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>    <span class=k>public</span> <span class=nv>$theName</span><span class=p>;</span>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a>    <span class=k>public</span> <span class=nv>$theType</span><span class=p>;</span>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a>    <span class=k>public</span> <span class=nv>$theYear</span><span class=p>;</span>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>columnMap</span><span class=p>()</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a>    <span class=p>{</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a>        <span class=c1>// Keys are the real names in the table and</span>
<a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a>        <span class=c1>// the values their names in the application</span>
<a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a>        <span class=k>return</span> <span class=p>[</span>
<a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a>            <span class=s1>&#39;id&#39;</span>       <span class=o>=&gt;</span> <span class=s1>&#39;code&#39;</span><span class=p>,</span>
<a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a>            <span class=s1>&#39;the_name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;theName&#39;</span><span class=p>,</span>
<a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a>            <span class=s1>&#39;the_type&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;theType&#39;</span><span class=p>,</span>
<a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a>            <span class=s1>&#39;the_year&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;theYear&#39;</span><span class=p>,</span>
<a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a>        <span class=p>];</span>
<a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a>    <span class=p>}</span>
<a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a><span class=p>}</span>
</code></pre></div> <p>Then you can use the new names naturally in your code:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=c1>// Find a robot by its name</span>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a>    <span class=s2>&quot;theName = &#39;Voltron&#39;&quot;</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=p>);</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=k>echo</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>theName</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=c1>// Get robots ordered by type</span>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>find</span><span class=p>(</span>
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>    <span class=p>[</span>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a>        <span class=s1>&#39;order&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;theType DESC&#39;</span><span class=p>,</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a>    <span class=p>]</span>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=p>);</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$robots</span> <span class=k>as</span> <span class=nv>$robot</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a>    <span class=k>echo</span> <span class=s1>&#39;Code: &#39;</span><span class=p>,</span> <span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=p>}</span>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a>
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=c1>// Create a robot</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=nv>$robot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Robots</span><span class=p>();</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a>
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>code</span>    <span class=o>=</span> <span class=s1>&#39;10101&#39;</span><span class=p>;</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>theName</span> <span class=o>=</span> <span class=s1>&#39;Bender&#39;</span><span class=p>;</span>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>theType</span> <span class=o>=</span> <span class=s1>&#39;Industrial&#39;</span><span class=p>;</span>
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>theYear</span> <span class=o>=</span> <span class=mi>2999</span><span class=p>;</span>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a>
<a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
</code></pre></div> <p>Consider the following when renaming your columns:</p> <ul> <li>References to attributes in relationships/validators must use the new names</li> <li>Refer the real column names will result in an exception by the ORM</li> </ul> <p>The independent column map allows you to:</p> <ul> <li>Write applications using your own conventions</li> <li>Eliminate vendor prefixes/suffixes in your code</li> <li>Change column names without change your application code</li> </ul> <h2 id=record-snapshots>Record Snapshots<a class=headerlink href=#record-snapshots title="Permanent link">&para;</a></h2> <p>Specific models could be set to maintain a record snapshot when they're queried. You can use this feature to implement auditing or just to know what fields are changed according to the data queried from the persistence:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=p>{</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>    <span class=p>{</span>
<a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>keepSnapshots</span><span class=p>(</span><span class=k>true</span><span class=p>);</span>
<a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a>    <span class=p>}</span>
<a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=p>}</span>
</code></pre></div> <p>When activating this feature the application consumes a bit more of memory to keep track of the original values obtained from the persistence. In models that have this feature activated you can check what fields changed as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=c1>// Get a record from the database</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>();</span>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=c1>// Change a column</span>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=s1>&#39;Other name&#39;</span><span class=p>;</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a>
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=nb>var_dump</span><span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>getChangedFields</span><span class=p>());</span> <span class=c1>// [&#39;name&#39;]</span>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=nb>var_dump</span><span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>hasChanged</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>));</span> <span class=c1>// true</span>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=nb>var_dump</span><span class=p>(</span><span class=nv>$robot</span><span class=o>-&gt;</span><span class=na>hasChanged</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>));</span> <span class=c1>// false</span>
</code></pre></div> <p>Snapshots are updated on model creation/update. Using <code>hasUpdated()</code> and <code>getUpdatedFields()</code> can be used to check if fields were updated after a create/save/update but it could potentially cause problems to your application if you execute <code>getChangedFields()</code> in <code>afterUpdate()</code>, <code>afterSave()</code> or <code>afterCreate()</code>. </p> <p>You can disable this functionality by using:</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=nx>Phalcon\Mvc\Model</span><span class=o>::</span><span class=na>setup</span><span class=p>(</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>    <span class=p>[</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>        <span class=s1>&#39;updateSnapshotOnSave&#39;</span> <span class=o>=&gt;</span> <span class=k>false</span><span class=p>,</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>    <span class=p>]</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=p>);</span>
</code></pre></div> or if you prefer set this in your <code>php.ini</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=na>phalcon.orm.update_snapshot_on_save</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>0</span>
</code></pre></div> <p>Using this functionality will have the following effect:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=k>class</span> <span class=nc>User</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=p>{</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a>  <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a>  <span class=p>{</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a>      <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>keepSnapshots</span><span class=p>(</span><span class=k>true</span><span class=p>);</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a>  <span class=p>}</span>
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=p>}</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=nv>$user</span>       <span class=o>=</span> <span class=k>new</span> <span class=nx>User</span><span class=p>();</span>
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=s1>&#39;Test User&#39;</span><span class=p>;</span>
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>create</span><span class=p>();</span>
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=nb>var_dump</span><span class=p>(</span><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>getChangedFields</span><span class=p>());</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>login</span> <span class=o>=</span> <span class=s1>&#39;testuser&#39;</span><span class=p>;</span>
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a><span class=nb>var_dump</span><span class=p>(</span><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>getChangedFields</span><span class=p>());</span>
<a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>update</span><span class=p>();</span>
<a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a><span class=nb>var_dump</span><span class=p>(</span><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>getChangedFields</span><span class=p>());</span>
</code></pre></div> <p>On Phalcon 3.4.0 and later it is:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=k>array</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=p>}</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=k>array</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=&gt;</span> 
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a>    <span class=nx>string</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span> <span class=s2>&quot;login&quot;</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=p>}</span>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=k>array</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=p>}</span>
</code></pre></div> <p><code>getUpdatedFields()</code> will properly return updated fields or as mentioned above you can go back to the previous behavior by setting the relevant ini value.</p> <h2 id=pointing-to-a-different-schema>Pointing to a different schema<a class=headerlink href=#pointing-to-a-different-schema title="Permanent link">&para;</a></h2> <p>If a model is mapped to a table that is in a different schemas/databases than the default. You can use the <code>setSchema()</code> method to define that:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a>
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=p>{</span>
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a>    <span class=p>{</span>
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>setSchema</span><span class=p>(</span><span class=s1>&#39;toys&#39;</span><span class=p>);</span>
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a>    <span class=p>}</span>
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=p>}</span>
</code></pre></div> <h2 id=setting-multiple-databases>Setting multiple databases<a class=headerlink href=#setting-multiple-databases title="Permanent link">&para;</a></h2> <p>In Phalcon, all models can belong to the same database connection or have an individual one. Actually, when <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> needs to connect to the database it requests the <code>db</code> service in the application's services container. You can overwrite this service setting it in the <code>initialize()</code> method:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=k>use</span> <span class=nx>Phalcon\Db\Adapter\Pdo\Mysql</span> <span class=k>as</span> <span class=nx>MysqlPdo</span><span class=p>;</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=k>use</span> <span class=nx>Phalcon\Db\Adapter\Pdo\PostgreSQL</span> <span class=k>as</span> <span class=nx>PostgreSQLPdo</span><span class=p>;</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=c1>// This service returns a MySQL database</span>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=nv>$di</span><span class=o>-&gt;</span><span class=na>set</span><span class=p>(</span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a>    <span class=s1>&#39;dbMysql&#39;</span><span class=p>,</span>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a>    <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a>        <span class=k>return</span> <span class=k>new</span> <span class=nx>MysqlPdo</span><span class=p>(</span>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a>            <span class=p>[</span>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a>                <span class=s1>&#39;host&#39;</span>     <span class=o>=&gt;</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a>                <span class=s1>&#39;username&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;root&#39;</span><span class=p>,</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a>                <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;secret&#39;</span><span class=p>,</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a>                <span class=s1>&#39;dbname&#39;</span>   <span class=o>=&gt;</span> <span class=s1>&#39;invo&#39;</span><span class=p>,</span>
<a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a>            <span class=p>]</span>
<a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a>        <span class=p>);</span>
<a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a>    <span class=p>}</span>
<a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a><span class=p>);</span>
<a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a>
<a id=__codelineno-57-21 name=__codelineno-57-21 href=#__codelineno-57-21></a><span class=c1>// This service returns a PostgreSQL database</span>
<a id=__codelineno-57-22 name=__codelineno-57-22 href=#__codelineno-57-22></a><span class=nv>$di</span><span class=o>-&gt;</span><span class=na>set</span><span class=p>(</span>
<a id=__codelineno-57-23 name=__codelineno-57-23 href=#__codelineno-57-23></a>    <span class=s1>&#39;dbPostgres&#39;</span><span class=p>,</span>
<a id=__codelineno-57-24 name=__codelineno-57-24 href=#__codelineno-57-24></a>    <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
<a id=__codelineno-57-25 name=__codelineno-57-25 href=#__codelineno-57-25></a>        <span class=k>return</span> <span class=k>new</span> <span class=nx>PostgreSQLPdo</span><span class=p>(</span>
<a id=__codelineno-57-26 name=__codelineno-57-26 href=#__codelineno-57-26></a>            <span class=p>[</span>
<a id=__codelineno-57-27 name=__codelineno-57-27 href=#__codelineno-57-27></a>                <span class=s1>&#39;host&#39;</span>     <span class=o>=&gt;</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
<a id=__codelineno-57-28 name=__codelineno-57-28 href=#__codelineno-57-28></a>                <span class=s1>&#39;username&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
<a id=__codelineno-57-29 name=__codelineno-57-29 href=#__codelineno-57-29></a>                <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
<a id=__codelineno-57-30 name=__codelineno-57-30 href=#__codelineno-57-30></a>                <span class=s1>&#39;dbname&#39;</span>   <span class=o>=&gt;</span> <span class=s1>&#39;invo&#39;</span><span class=p>,</span>
<a id=__codelineno-57-31 name=__codelineno-57-31 href=#__codelineno-57-31></a>            <span class=p>]</span>
<a id=__codelineno-57-32 name=__codelineno-57-32 href=#__codelineno-57-32></a>        <span class=p>);</span>
<a id=__codelineno-57-33 name=__codelineno-57-33 href=#__codelineno-57-33></a>    <span class=p>}</span>
<a id=__codelineno-57-34 name=__codelineno-57-34 href=#__codelineno-57-34></a><span class=p>);</span>
</code></pre></div> <p>Then, in the <code>initialize()</code> method, we define the connection service for the model:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a>
<a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=p>{</span>
<a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a>    <span class=p>{</span>
<a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>setConnectionService</span><span class=p>(</span><span class=s1>&#39;dbPostgres&#39;</span><span class=p>);</span>
<a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a>    <span class=p>}</span>
<a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=p>}</span>
</code></pre></div> <p>But Phalcon offers you more flexibility, you can define the connection that must be used to <code>read</code> and for <code>write</code>. This is specially useful to balance the load to your databases implementing a master-slave architecture:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=p>{</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initialize</span><span class=p>()</span>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a>    <span class=p>{</span>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>setReadConnectionService</span><span class=p>(</span><span class=s1>&#39;dbSlave&#39;</span><span class=p>);</span>
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>setWriteConnectionService</span><span class=p>(</span><span class=s1>&#39;dbMaster&#39;</span><span class=p>);</span>
<a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a>    <span class=p>}</span>
<a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=p>}</span>
</code></pre></div> <p>The ORM also provides Horizontal Sharding facilities, by allowing you to implement a 'shard' selection according to the current query conditions:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a>
<a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a>
<a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=p>{</span>
<a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a>    <span class=sd>/**</span>
<a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=sd>     * Dynamically selects a shard</span>
<a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=sd>     *</span>
<a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=sd>     * @param array $intermediate</span>
<a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=sd>     * @param array $bindParams</span>
<a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=sd>     * @param array $bindTypes</span>
<a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=sd>     */</span>
<a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>selectReadConnection</span><span class=p>(</span><span class=nv>$intermediate</span><span class=p>,</span> <span class=nv>$bindParams</span><span class=p>,</span> <span class=nv>$bindTypes</span><span class=p>)</span>
<a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a>    <span class=p>{</span>
<a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a>        <span class=c1>// Check if there is a &#39;where&#39; clause in the select</span>
<a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a>        <span class=k>if</span> <span class=p>(</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$intermediate</span><span class=p>[</span><span class=s1>&#39;where&#39;</span><span class=p>]))</span> <span class=p>{</span>
<a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a>            <span class=nv>$conditions</span> <span class=o>=</span> <span class=nv>$intermediate</span><span class=p>[</span><span class=s1>&#39;where&#39;</span><span class=p>];</span>
<a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a>
<a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a>            <span class=c1>// Choose the possible shard according to the conditions</span>
<a id=__codelineno-60-23 name=__codelineno-60-23 href=#__codelineno-60-23></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$conditions</span><span class=p>[</span><span class=s1>&#39;left&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=s1>&#39;id&#39;</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-60-24 name=__codelineno-60-24 href=#__codelineno-60-24></a>                <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$conditions</span><span class=p>[</span><span class=s1>&#39;right&#39;</span><span class=p>][</span><span class=s1>&#39;value&#39;</span><span class=p>];</span>
<a id=__codelineno-60-25 name=__codelineno-60-25 href=#__codelineno-60-25></a>
<a id=__codelineno-60-26 name=__codelineno-60-26 href=#__codelineno-60-26></a>                <span class=k>if</span> <span class=p>(</span><span class=nv>$id</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nv>$id</span> <span class=o>&lt;</span> <span class=mi>10000</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-60-27 name=__codelineno-60-27 href=#__codelineno-60-27></a>                    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getDI</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;dbShard1&#39;</span><span class=p>);</span>
<a id=__codelineno-60-28 name=__codelineno-60-28 href=#__codelineno-60-28></a>                <span class=p>}</span>
<a id=__codelineno-60-29 name=__codelineno-60-29 href=#__codelineno-60-29></a>
<a id=__codelineno-60-30 name=__codelineno-60-30 href=#__codelineno-60-30></a>                <span class=k>if</span> <span class=p>(</span><span class=nv>$id</span> <span class=o>&gt;</span> <span class=mi>10000</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-60-31 name=__codelineno-60-31 href=#__codelineno-60-31></a>                    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getDI</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;dbShard2&#39;</span><span class=p>);</span>
<a id=__codelineno-60-32 name=__codelineno-60-32 href=#__codelineno-60-32></a>                <span class=p>}</span>
<a id=__codelineno-60-33 name=__codelineno-60-33 href=#__codelineno-60-33></a>            <span class=p>}</span>
<a id=__codelineno-60-34 name=__codelineno-60-34 href=#__codelineno-60-34></a>        <span class=p>}</span>
<a id=__codelineno-60-35 name=__codelineno-60-35 href=#__codelineno-60-35></a>
<a id=__codelineno-60-36 name=__codelineno-60-36 href=#__codelineno-60-36></a>        <span class=c1>// Use a default shard</span>
<a id=__codelineno-60-37 name=__codelineno-60-37 href=#__codelineno-60-37></a>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getDI</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;dbShard0&#39;</span><span class=p>);</span>
<a id=__codelineno-60-38 name=__codelineno-60-38 href=#__codelineno-60-38></a>    <span class=p>}</span>
<a id=__codelineno-60-39 name=__codelineno-60-39 href=#__codelineno-60-39></a><span class=p>}</span>
</code></pre></div> <p>The <code>selectReadConnection()</code> method is called to choose the right connection, this method intercepts any new query executed:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=k>use</span> <span class=nx>Store\Toys\Robots</span><span class=p>;</span>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=nv>$robot</span> <span class=o>=</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>findFirst</span><span class=p>(</span><span class=s1>&#39;id = 101&#39;</span><span class=p>);</span>
</code></pre></div> <h2 id=injecting-services-into-models>Injecting services into Models<a class=headerlink href=#injecting-services-into-models title="Permanent link">&para;</a></h2> <p>You may be required to access the application services within a model, the following example explains how to do that:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=k>namespace</span> <span class=nx>Store\Toys</span><span class=p>;</span>
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=p>{</span>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>notSaved</span><span class=p>()</span>
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a>    <span class=p>{</span>
<a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a>        <span class=c1>// Obtain the flash service from the DI container</span>
<a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a>        <span class=nv>$flash</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getDI</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getFlash</span><span class=p>();</span>
<a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a>
<a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a>        <span class=nv>$messages</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getMessages</span><span class=p>();</span>
<a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a>
<a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a>        <span class=c1>// Show validation messages</span>
<a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$messages</span> <span class=k>as</span> <span class=nv>$message</span><span class=p>)</span> <span class=p>{</span>
<a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a>            <span class=nv>$flash</span><span class=o>-&gt;</span><span class=na>error</span><span class=p>(</span><span class=nv>$message</span><span class=p>);</span>
<a id=__codelineno-62-19 name=__codelineno-62-19 href=#__codelineno-62-19></a>        <span class=p>}</span>
<a id=__codelineno-62-20 name=__codelineno-62-20 href=#__codelineno-62-20></a>    <span class=p>}</span>
<a id=__codelineno-62-21 name=__codelineno-62-21 href=#__codelineno-62-21></a><span class=p>}</span>
</code></pre></div> <p>The <code>notSaved</code> event is triggered every time that a <code>create</code> or <code>update</code> action fails. So we're flashing the validation messages obtaining the <code>flash</code> service from the DI container. By doing this, we don't have to print messages after each save.</p> <h2 id=disablingenabling-features>Disabling/Enabling Features<a class=headerlink href=#disablingenabling-features title="Permanent link">&para;</a></h2> <p>In the ORM we have implemented a mechanism that allow you to enable/disable specific features or options globally on the fly. According to how you use the ORM you can disable that you aren't using. These options can also be temporarily disabled if required:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a>
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=nx>Model</span><span class=o>::</span><span class=na>setup</span><span class=p>(</span>
<a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a>    <span class=p>[</span>
<a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a>        <span class=s1>&#39;events&#39;</span>         <span class=o>=&gt;</span> <span class=k>false</span><span class=p>,</span>
<a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a>        <span class=s1>&#39;columnRenaming&#39;</span> <span class=o>=&gt;</span> <span class=k>false</span><span class=p>,</span>
<a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a>    <span class=p>]</span>
<a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=p>);</span>
</code></pre></div> <p>The available options are:</p> <table> <thead> <tr> <th>Option</th> <th>Description</th> <th style="text-align: center;">Default</th> </tr> </thead> <tbody> <tr> <td>astCache</td> <td>Enables/Disables callbacks, hooks and event notifications from all the models</td> <td style="text-align: center;"><code>null</code></td> </tr> <tr> <td>cacheLevel</td> <td>Sets the cache level for the ORM</td> <td style="text-align: center;"><code>3</code></td> </tr> <tr> <td>castOnHydrate</td> <td></td> <td style="text-align: center;"><code>false</code></td> </tr> <tr> <td>columnRenaming</td> <td>Enables/Disables the column renaming</td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>disableAssignSetters</td> <td>Allow disabling setters in your model</td> <td style="text-align: center;"><code>false</code></td> </tr> <tr> <td>enableImplicitJoins</td> <td></td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>enableLiterals</td> <td></td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>escapeIdentifiers</td> <td></td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>events</td> <td>Enables/Disables callbacks, hooks and event notifications from all the models</td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>exceptionOnFailedSave</td> <td>Enables/Disables throwing an exception when there is a failed <code>save()</code></td> <td style="text-align: center;"><code>false</code></td> </tr> <tr> <td>forceCasting</td> <td></td> <td style="text-align: center;"><code>false</code></td> </tr> <tr> <td>ignoreUnknownColumns</td> <td>Enables/Disables ignoring unknown columns on the model</td> <td style="text-align: center;"><code>false</code></td> </tr> <tr> <td>lateStateBinding</td> <td>Enables/Disables late state binding of the <code>Phalcon\Mvc\Model::cloneResultMap()</code> method</td> <td style="text-align: center;"><code>false</code></td> </tr> <tr> <td>notNullValidations</td> <td>The ORM automatically validate the not null columns present in the mapped table</td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>parserCache</td> <td></td> <td style="text-align: center;"><code>null</code></td> </tr> <tr> <td>phqlLiterals</td> <td>Enables/Disables literals in the PHQL parser</td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>uniqueCacheId</td> <td></td> <td style="text-align: center;"><code>3</code></td> </tr> <tr> <td>updateSnapshotOnSave</td> <td>Enables/Disables updating snapshots on <code>save()</code></td> <td style="text-align: center;"><code>true</code></td> </tr> <tr> <td>virtualForeignKeys</td> <td>Enables/Disables the virtual foreign keys</td> <td style="text-align: center;"><code>true</code></td> </tr> </tbody> </table> <div class="admonition warning"> <p class=admonition-title>NOTE</p> <p><code>Phalcon\Mvc\Model::assign()</code> (which is used also when creating/updating/saving model) is always using setters if they exist when have data arguments passed, even when it's required or necessary. This will add some additional overhead to your application. You can change this behavior by adding <code>phalcon.orm.disable_assign_setters = 1</code> to your ini file, it will just simply use <code>$this-&gt;property = value</code>.</p> </div> <h2 id=stand-alone-component>Stand-Alone component<a class=headerlink href=#stand-alone-component title="Permanent link">&para;</a></h2> <p>Using <a href=../api/Phalcon_Mvc_Model/ >Phalcon\Mvc\Model</a> in a stand-alone mode can be demonstrated below:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=o>&lt;?</span><span class=nx>php</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=k>use</span> <span class=nx>Phalcon\Di</span><span class=p>;</span>
<a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model</span><span class=p>;</span>
<a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model\Manager</span> <span class=k>as</span> <span class=nx>ModelsManager</span><span class=p>;</span>
<a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=k>use</span> <span class=nx>Phalcon\Db\Adapter\Pdo\Sqlite</span> <span class=k>as</span> <span class=nx>Connection</span><span class=p>;</span>
<a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=k>use</span> <span class=nx>Phalcon\Mvc\Model\Metadata\Memory</span> <span class=k>as</span> <span class=nx>MetaData</span><span class=p>;</span>
<a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a>
<a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=nv>$di</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Di</span><span class=p>();</span>
<a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a>
<a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=c1>// Setup a connection</span>
<a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a><span class=nv>$di</span><span class=o>-&gt;</span><span class=na>set</span><span class=p>(</span>
<a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a>    <span class=s1>&#39;db&#39;</span><span class=p>,</span>
<a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a>    <span class=k>new</span> <span class=nx>Connection</span><span class=p>(</span>
<a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a>        <span class=p>[</span>
<a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a>            <span class=s1>&#39;dbname&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;sample.db&#39;</span><span class=p>,</span>
<a id=__codelineno-64-17 name=__codelineno-64-17 href=#__codelineno-64-17></a>        <span class=p>]</span>
<a id=__codelineno-64-18 name=__codelineno-64-18 href=#__codelineno-64-18></a>    <span class=p>)</span>
<a id=__codelineno-64-19 name=__codelineno-64-19 href=#__codelineno-64-19></a><span class=p>);</span>
<a id=__codelineno-64-20 name=__codelineno-64-20 href=#__codelineno-64-20></a>
<a id=__codelineno-64-21 name=__codelineno-64-21 href=#__codelineno-64-21></a><span class=c1>// Set a models manager</span>
<a id=__codelineno-64-22 name=__codelineno-64-22 href=#__codelineno-64-22></a><span class=nv>$di</span><span class=o>-&gt;</span><span class=na>set</span><span class=p>(</span>
<a id=__codelineno-64-23 name=__codelineno-64-23 href=#__codelineno-64-23></a>    <span class=s1>&#39;modelsManager&#39;</span><span class=p>,</span>
<a id=__codelineno-64-24 name=__codelineno-64-24 href=#__codelineno-64-24></a>    <span class=k>new</span> <span class=nx>ModelsManager</span><span class=p>()</span>
<a id=__codelineno-64-25 name=__codelineno-64-25 href=#__codelineno-64-25></a><span class=p>);</span>
<a id=__codelineno-64-26 name=__codelineno-64-26 href=#__codelineno-64-26></a>
<a id=__codelineno-64-27 name=__codelineno-64-27 href=#__codelineno-64-27></a><span class=c1>// Use the memory meta-data adapter or other</span>
<a id=__codelineno-64-28 name=__codelineno-64-28 href=#__codelineno-64-28></a><span class=nv>$di</span><span class=o>-&gt;</span><span class=na>set</span><span class=p>(</span>
<a id=__codelineno-64-29 name=__codelineno-64-29 href=#__codelineno-64-29></a>    <span class=s1>&#39;modelsMetadata&#39;</span><span class=p>,</span>
<a id=__codelineno-64-30 name=__codelineno-64-30 href=#__codelineno-64-30></a>    <span class=k>new</span> <span class=nx>MetaData</span><span class=p>()</span>
<a id=__codelineno-64-31 name=__codelineno-64-31 href=#__codelineno-64-31></a><span class=p>);</span>
<a id=__codelineno-64-32 name=__codelineno-64-32 href=#__codelineno-64-32></a>
<a id=__codelineno-64-33 name=__codelineno-64-33 href=#__codelineno-64-33></a><span class=c1>// Create a model</span>
<a id=__codelineno-64-34 name=__codelineno-64-34 href=#__codelineno-64-34></a><span class=k>class</span> <span class=nc>Robots</span> <span class=k>extends</span> <span class=nx>Model</span>
<a id=__codelineno-64-35 name=__codelineno-64-35 href=#__codelineno-64-35></a><span class=p>{</span>
<a id=__codelineno-64-36 name=__codelineno-64-36 href=#__codelineno-64-36></a>
<a id=__codelineno-64-37 name=__codelineno-64-37 href=#__codelineno-64-37></a><span class=p>}</span>
<a id=__codelineno-64-38 name=__codelineno-64-38 href=#__codelineno-64-38></a>
<a id=__codelineno-64-39 name=__codelineno-64-39 href=#__codelineno-64-39></a><span class=c1>// Use the model</span>
<a id=__codelineno-64-40 name=__codelineno-64-40 href=#__codelineno-64-40></a><span class=k>echo</span> <span class=nx>Robots</span><span class=o>::</span><span class=na>count</span><span class=p>();</span>
</code></pre></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../db-odm/ class="md-footer__link md-footer__link--prev" aria-label="Previous: ODM"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> ODM </div> </div> </a> <a href=../db-models-behaviors/ class="md-footer__link md-footer__link--next" aria-label="Next: Behaviors"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Behaviors </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2012 - present Phalcon Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://phalcon.io/discord target=_blank rel=noopener title=Discord class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://phalcon.io/discussions target=_blank rel=noopener title="GitHub Discussions" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 22a1 1 0 0 1-1-1v-3H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6.1l-3.7 3.71c-.2.19-.45.29-.7.29z"/></svg> </a> <a href=https://phalcon.io/github target=_blank rel=noopener title="GitHub Project" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://phalcon.io/telegram target=_blank rel=noopener title=Telegram class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8m114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.45 10.45 0 0 1 3.53 6.716 43.8 43.8 0 0 1 .417 9.769"/></svg> </a> <a href=https://phalcon.io/gab target=_blank rel=noopener title=Gab class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M368 32c41.7 0 75.9 31.8 79.7 72.5l85.6 26.3c25.4 7.8 42.8 31.3 42.8 57.9 0 21.8-11.7 41.9-30.7 52.7l-144.6 82.1 92.5 92.5H544c17.7 0 32 14.3 32 32s-14.3 32-32 32h-64c-8.5 0-16.6-3.4-22.6-9.4L346.9 360.2c11.7-36 3.2-77.1-25.4-105.7-40.6-40.6-106.3-40.6-146.9-.1l-73.6 70c-6.4 6.1-6.7 16.2-.6 22.6s16.2 6.6 22.6.6l73.8-70.2.1-.1.1-.1c3.5-3.5 7.3-6.6 11.3-9.2 27.9-18.5 65.9-15.4 90.5 9.2 24.7 24.7 27.7 62.9 9 90.9-2.6 3.8-5.6 7.5-9 10.9l-37 37H352c17.7 0 32 14.3 32 32s-14.3 32-32 32H64c-35.3 0-64-28.7-64-64C0 249.6 127 112.9 289.3 97.5 296.2 60.2 328.8 32 368 32m0 104a24 24 0 1 0 0-48 24 24 0 1 0 0 48"/></svg> </a> <a href=https://phalcon.io/t target=_blank rel=noopener title=Twitter class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://phalcon.io/fb target=_blank rel=noopener title=Facebook class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg> </a> <a href=https://phalcon.io/linkedin target=_blank rel=noopener title=LinkedIn class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://phalcon.io/youtube target=_blank rel=noopener title=LinkedIn class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../assets/javascripts/bundle.88dd0f4e.min.js></script> </body> </html>